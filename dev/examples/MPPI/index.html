<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 20,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 1000 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip1600">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip1600)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip1601">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip1600)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip1602">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip1602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip1602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip1602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip1602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip1602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1479.3 2352.76,1479.3 
  "/>
<polyline clip-path="url(#clip1602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.68 2352.76,1131.68 
  "/>
<polyline clip-path="url(#clip1602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,784.066 2352.76,784.066 
  "/>
<polyline clip-path="url(#clip1602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.45 2352.76,436.45 
  "/>
<polyline clip-path="url(#clip1602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.8335 2352.76,88.8335 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1479.3 114.181,1479.3 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.68 114.181,1131.68 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,784.066 114.181,784.066 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.45 114.181,436.45 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.8335 114.181,88.8335 
  "/>
<g clip-path="url(#clip1600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip1600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip1600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip1600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip1600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.8)" x="62.9921" y="1496.8">0.00</text>
</g>
<g clip-path="url(#clip1600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1149.18)" x="62.9921" y="1149.18">0.25</text>
</g>
<g clip-path="url(#clip1600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.566)" x="62.9921" y="801.566">0.50</text>
</g>
<g clip-path="url(#clip1600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 453.95)" x="62.9921" y="453.95">0.75</text>
</g>
<g clip-path="url(#clip1600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.334)" x="62.9921" y="106.334">1.00</text>
</g>
<polyline clip-path="url(#clip1602)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1479.3 158.266,1478.8 165.415,1478.36 172.564,1476.34 179.713,1473.64 186.862,1470.34 194.011,1464.65 201.16,1457.98 208.308,1450.81 215.457,1439.51 
  222.606,1426.27 229.755,1408.92 236.904,1387.87 244.053,1364.82 251.202,1340.15 258.351,1313.03 265.499,1283.88 272.648,1253.54 279.797,1220.61 286.946,1186.1 
  294.095,1147.59 301.244,1105.08 308.393,1059.22 315.542,1014.04 322.69,965.28 329.839,915.401 336.988,865.757 344.137,813.107 351.286,761.667 358.435,709.16 
  365.584,656.85 372.733,604.238 379.881,551.024 387.03,498.144 394.179,447.407 401.328,399.259 408.477,354.081 415.626,313.249 422.775,275.34 429.924,241.722 
  437.072,212.189 444.221,186.496 451.37,163.623 458.519,144.846 465.668,130.139 472.817,119.178 479.966,110.294 487.115,104.232 494.263,100.818 501.412,96.6953 
  508.561,94.3699 515.71,91.7605 522.859,90.5524 530.008,93.2349 537.157,96.0114 544.306,96.581 551.454,96.1128 558.603,93.8049 565.752,90.7888 572.901,90.8123 
  580.05,91.0433 587.199,91.3904 594.348,92.8644 601.497,91.8989 608.645,90.4634 615.794,93.1568 622.943,95.628 630.092,96.1309 637.241,95.7956 644.39,96.3911 
  651.539,93.9834 658.687,91.6727 665.836,90.0248 672.985,90.2378 680.134,90.5912 687.283,89.6337 694.432,90.3846 701.581,91.3024 708.73,91.1517 715.878,90.6485 
  723.027,92.3731 730.176,94.6103 737.325,94.9819 744.474,94.0789 751.623,92.0285 758.772,89.3699 765.921,90.2084 773.069,90.1173 780.218,89.6081 787.367,89.5093 
  794.516,89.8941 801.665,90.7157 808.814,90.3477 815.963,89.3528 823.112,91.0741 830.26,91.3656 837.409,90.9566 844.558,89.2032 851.707,89.1826 858.856,89.1186 
  866.005,90.0204 873.154,90.0614 880.303,90.7956 887.451,90.8999 894.6,91.721 901.749,91.3924 908.898,91.5218 916.047,90.6683 923.196,90.8128 930.345,90.7482 
  937.494,90.2307 944.642,89.5948 951.791,91.2606 958.94,93.4497 966.089,95.5453 973.238,96.9235 980.387,95.2852 987.536,94.5392 994.685,93.8981 1001.83,93.2294 
  1008.98,93.1904 1016.13,91.8925 1023.28,90.2332 1030.43,89.883 1037.58,89.5099 1044.73,92.5724 1051.88,92.3744 1059.02,90.7811 1066.17,89.7524 1073.32,91.0373 
  1080.47,90.9591 1087.62,90.3585 1094.77,90.1083 1101.92,89.255 1109.07,89.463 1116.22,89.3315 1123.36,89.8662 1130.51,90.8075 1137.66,90.9737 1144.81,91.471 
  1151.96,93.2949 1159.11,93.7488 1166.26,93.1703 1173.41,93.4598 1180.56,93.8811 1187.7,93.5427 1194.85,93.1969 1202,93.603 1209.15,94.9527 1216.3,96.1604 
  1223.45,96.3301 1230.6,96.4007 1237.75,96.614 1244.9,94.8511 1252.04,93.6478 1259.19,91.918 1266.34,91.1743 1273.49,91.1409 1280.64,91.5166 1287.79,90.9839 
  1294.94,90.4353 1302.09,90.7907 1309.23,91.5541 1316.38,92.033 1323.53,92.897 1330.68,92.3435 1337.83,91.0341 1344.98,90.9202 1352.13,91.1615 1359.28,90.5987 
  1366.43,90.6904 1373.57,91.3615 1380.72,92.8807 1387.87,93.2837 1395.02,93.1615 1402.17,93.8784 1409.32,92.4142 1416.47,92.7731 1423.62,91.331 1430.77,90.9454 
  1437.91,92.8035 1445.06,93.2216 1452.21,93.0935 1459.36,91.5058 1466.51,91.473 1473.66,90.9311 1480.81,90.9532 1487.96,90.8102 1495.11,90.5333 1502.25,89.8145 
  1509.4,89.1464 1516.55,90.938 1523.7,92.2773 1530.85,94.7066 1538,95.0449 1545.15,94.8432 1552.3,94.5906 1559.45,93.271 1566.59,91.9391 1573.74,93.1496 
  1580.89,94.3424 1588.04,92.0503 1595.19,92.0685 1602.34,93.5885 1609.49,94.8293 1616.64,94.111 1623.79,93.8378 1630.93,95.4909 1638.08,94.8031 1645.23,94.2172 
  1652.38,92.9106 1659.53,91.8245 1666.68,90.6914 1673.83,89.1855 1680.98,89.6491 1688.13,89.5814 1695.27,90.1669 1702.42,91.425 1709.57,91.363 1716.72,90.2415 
  1723.87,90.9782 1731.02,89.978 1738.17,90.2088 1745.32,89.8677 1752.47,89.4965 1759.61,91.0291 1766.76,92.2384 1773.91,91.7296 1781.06,90.8504 1788.21,91.2608 
  1795.36,91.9647 1802.51,91.9168 1809.66,91.0969 1816.8,90.7397 1823.95,89.5018 1831.1,89.6706 1838.25,90.0821 1845.4,89.4972 1852.55,90.4422 1859.7,89.5976 
  1866.85,91.0684 1874,91.1753 1881.14,90.1127 1888.29,92.0938 1895.44,92.3619 1902.59,92.6349 1909.74,92.0895 1916.89,90.4315 1924.04,89.2279 1931.19,90.6138 
  1938.34,92.3597 1945.48,92.3756 1952.63,91.545 1959.78,90.1403 1966.93,90.9606 1974.08,91.0333 1981.23,90.448 1988.38,91.0999 1995.53,91.8828 2002.68,92.6198 
  2009.82,91.8103 2016.97,90.6737 2024.12,89.2286 2031.27,91.0849 2038.42,91.3367 2045.57,93.0701 2052.72,94.6033 2059.87,94.8983 2067.02,94.3008 2074.16,93.1783 
  2081.31,91.071 2088.46,91.2831 2095.61,93.6921 2102.76,95.6851 2109.91,95.2507 2117.06,95.4188 2124.21,94.725 2131.36,93.2461 2138.5,91.3864 2145.65,90.146 
  2152.8,88.9724 2159.95,89.9769 2167.1,91.4392 2174.25,91.4192 2181.4,90.1352 2188.55,89.4954 2195.7,88.9544 2202.84,89.3852 2209.99,89.7285 2217.14,90.4604 
  2224.29,90.1986 2231.44,89.6006 2238.59,90.4078 2245.74,89.9628 2252.89,91.2742 2260.04,91.8575 2267.18,90.7693 2274.33,91.5984 2281.48,91.1782 2288.63,92.5532 
  
  "/>
<path clip-path="url(#clip1600)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip1600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip1600)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip1600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 January 2020 07:26">Monday 13 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
