<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 20,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 1000 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip1800">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip1800)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip1801">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip1800)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip1802">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip1802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip1802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip1802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip1802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip1802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1479.23 2352.76,1479.23 
  "/>
<polyline clip-path="url(#clip1802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.64 2352.76,1131.64 
  "/>
<polyline clip-path="url(#clip1802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,784.051 2352.76,784.051 
  "/>
<polyline clip-path="url(#clip1802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.462 2352.76,436.462 
  "/>
<polyline clip-path="url(#clip1802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.8721 2352.76,88.8721 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1479.23 114.181,1479.23 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.64 114.181,1131.64 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,784.051 114.181,784.051 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.462 114.181,436.462 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.8721 114.181,88.8721 
  "/>
<g clip-path="url(#clip1800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip1800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip1800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip1800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip1800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.73)" x="62.9921" y="1496.73">0.00</text>
</g>
<g clip-path="url(#clip1800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1149.14)" x="62.9921" y="1149.14">0.25</text>
</g>
<g clip-path="url(#clip1800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.551)" x="62.9921" y="801.551">0.50</text>
</g>
<g clip-path="url(#clip1800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 453.962)" x="62.9921" y="453.962">0.75</text>
</g>
<g clip-path="url(#clip1800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.372)" x="62.9921" y="106.372">1.00</text>
</g>
<polyline clip-path="url(#clip1802)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1479.23 158.266,1479.3 165.415,1479.07 172.564,1477.51 179.713,1473.85 186.862,1468.49 194.011,1461.11 201.16,1451.03 208.308,1440.07 215.457,1426.55 
  222.606,1411.29 229.755,1393.02 236.904,1371.39 244.053,1349.87 251.202,1327.52 258.351,1301.33 265.499,1271.09 272.648,1236.78 279.797,1199.13 286.946,1160.02 
  294.095,1116.94 301.244,1070.18 308.393,1019.45 315.542,968.308 322.69,913.202 329.839,855.972 336.988,797.927 344.137,739.291 351.286,679.68 358.435,621.124 
  365.584,564.019 372.733,507.496 379.881,453.73 387.03,403.797 394.179,356.471 401.328,312.704 408.477,273.301 415.626,238.255 422.775,205.812 429.924,177.709 
  437.072,153.995 444.221,133.36 451.37,117.345 458.519,104.646 465.668,96.3222 472.817,102.012 479.966,108.746 487.115,111.987 494.263,113.023 501.412,113.973 
  508.561,115.602 515.71,116.436 522.859,114.476 530.008,111.346 537.157,109.155 544.306,107.441 551.454,106.606 558.603,104.476 565.752,103.231 572.901,100.009 
  580.05,95.0512 587.199,92.3314 594.348,91.4772 601.497,91.5914 608.645,92.8012 615.794,94.1923 622.943,94.2133 630.092,92.4591 637.241,91.419 644.39,91.0262 
  651.539,90.8432 658.687,89.9585 665.836,91.1437 672.985,89.824 680.134,90.1998 687.283,91.9925 694.432,92.6234 701.581,93.0431 708.73,92.1984 715.878,91.5139 
  723.027,92.8327 730.176,93.0603 737.325,92.3527 744.474,92.0972 751.623,93.7341 758.772,92.6281 765.921,91.8073 773.069,91.2905 780.218,89.6885 787.367,90.4593 
  794.516,90.4183 801.665,89.8759 808.814,90.6964 815.963,90.43 823.112,89.4066 830.26,89.4888 837.409,90.518 844.558,90.4288 851.707,91.3284 858.856,92.6298 
  866.005,92.105 873.154,91.5465 880.303,91.3676 887.451,93.2658 894.6,92.252 901.749,90.3144 908.898,89.5824 916.047,90.9383 923.196,90.0405 930.345,91.13 
  937.494,92.4263 944.642,93.8126 951.791,95.7543 958.94,95.2412 966.089,93.2658 973.238,90.2443 980.387,89.7763 987.536,91.2381 994.685,91.0184 1001.83,91.4468 
  1008.98,91.8198 1016.13,91.9807 1023.28,91.8286 1030.43,92.7954 1037.58,95.9753 1044.73,97.3232 1051.88,96.101 1059.02,93.8376 1066.17,91.6036 1073.32,89.5173 
  1080.47,91.2252 1087.62,91.6465 1094.77,91.7505 1101.92,91.6384 1109.07,91.1263 1116.22,90.2581 1123.36,91.4095 1130.51,92.9461 1137.66,93.5724 1144.81,92.7923 
  1151.96,90.7828 1159.11,90.6747 1166.26,91.9166 1173.41,92.0033 1180.56,91.5365 1187.7,91.2622 1194.85,91.0338 1202,90.6294 1209.15,91.3146 1216.3,91.1324 
  1223.45,89.9785 1230.6,90.1374 1237.75,91.4481 1244.9,91.8847 1252.04,91.6922 1259.19,91.6733 1266.34,91.3031 1273.49,89.084 1280.64,89.5818 1287.79,89.5283 
  1294.94,89.2711 1302.09,90.2394 1309.23,90.7948 1316.38,91.6753 1323.53,93.2551 1330.68,94.3274 1337.83,94.1574 1344.98,92.268 1352.13,90.8957 1359.28,90.7071 
  1366.43,89.9189 1373.57,90.403 1380.72,92.0309 1387.87,92.543 1395.02,91.4789 1402.17,91.4515 1409.32,90.3586 1416.47,91.2688 1423.62,92.6433 1430.77,93.8662 
  1437.91,93.6389 1445.06,90.4286 1452.21,90.7859 1459.36,91.4231 1466.51,90.9074 1473.66,92.0153 1480.81,92.3296 1487.96,93.3153 1495.11,93.3186 1502.25,92.9263 
  1509.4,91.8744 1516.55,89.7691 1523.7,90.5725 1530.85,91.4812 1538,91.2983 1545.15,90.998 1552.3,90.0663 1559.45,90.9352 1566.59,92.1948 1573.74,92.3022 
  1580.89,90.7551 1588.04,89.4663 1595.19,90.4685 1602.34,89.8922 1609.49,90.226 1616.64,90.1931 1623.79,89.4645 1630.93,89.9105 1638.08,90.7173 1645.23,90.6481 
  1652.38,92.1704 1659.53,92.2641 1666.68,90.5437 1673.83,89.8548 1680.98,89.8507 1688.13,91.0495 1695.27,92.3378 1702.42,92.6721 1709.57,91.8884 1716.72,89.95 
  1723.87,89.8139 1731.02,90.3005 1738.17,90.328 1745.32,89.9875 1752.47,91.7713 1759.61,93.1114 1766.76,95.5722 1773.91,95.7598 1781.06,92.901 1788.21,90.1025 
  1795.36,89.7619 1802.51,90.2875 1809.66,90.3008 1816.8,89.81 1823.95,90.382 1831.1,91.0063 1838.25,90.5555 1845.4,90.7424 1852.55,91.5172 1859.7,92.0484 
  1866.85,93.1954 1874,93.0485 1881.14,92.4822 1888.29,91.6608 1895.44,91.529 1902.59,91.0102 1909.74,89.8869 1916.89,90.1487 1924.04,91.4482 1931.19,91.6596 
  1938.34,90.7672 1945.48,91.7484 1952.63,91.4379 1959.78,91.427 1966.93,91.1531 1974.08,90.6101 1981.23,91.2478 1988.38,91.0806 1995.53,91.2965 2002.68,90.5184 
  2009.82,90.0368 2016.97,90.5804 2024.12,89.612 2031.27,88.9544 2038.42,90.0484 2045.57,89.7453 2052.72,90.6999 2059.87,90.2321 2067.02,89.9972 2074.16,93.7582 
  2081.31,96.1191 2088.46,95.7037 2095.61,95.9131 2102.76,95.1084 2109.91,95.0782 2117.06,94.1902 2124.21,92.6911 2131.36,90.5692 2138.5,89.7237 2145.65,89.9527 
  2152.8,91.168 2159.95,90.0822 2167.1,90.0349 2174.25,91.0937 2181.4,90.2362 2188.55,89.3978 2195.7,90.3505 2202.84,89.4784 2209.99,90.0627 2217.14,90.3007 
  2224.29,91.0875 2231.44,90.8425 2238.59,90.4662 2245.74,89.4826 2252.89,89.7711 2260.04,91.3011 2267.18,91.6842 2274.33,92.2974 2281.48,91.9754 2288.63,90.8898 
  
  "/>
<path clip-path="url(#clip1800)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip1800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip1800)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip1800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 11 January 2020 01:52">Saturday 11 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
