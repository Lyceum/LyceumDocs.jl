<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 20,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 1000 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip7100">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip7100)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip7101">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip7100)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip7102">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip7102)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip7102)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip7102)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip7102)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip7102)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1478.89 2352.76,1478.89 
  "/>
<polyline clip-path="url(#clip7102)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.36 2352.76,1131.36 
  "/>
<polyline clip-path="url(#clip7102)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,783.826 2352.76,783.826 
  "/>
<polyline clip-path="url(#clip7102)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.294 2352.76,436.294 
  "/>
<polyline clip-path="url(#clip7102)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.7624 2352.76,88.7624 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1478.89 114.181,1478.89 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.36 114.181,1131.36 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,783.826 114.181,783.826 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.294 114.181,436.294 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.7624 114.181,88.7624 
  "/>
<g clip-path="url(#clip7100)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip7100)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip7100)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip7100)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip7100)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.39)" x="62.9921" y="1496.39">0.00</text>
</g>
<g clip-path="url(#clip7100)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1148.86)" x="62.9921" y="1148.86">0.25</text>
</g>
<g clip-path="url(#clip7100)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.326)" x="62.9921" y="801.326">0.50</text>
</g>
<g clip-path="url(#clip7100)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 453.794)" x="62.9921" y="453.794">0.75</text>
</g>
<g clip-path="url(#clip7100)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.262)" x="62.9921" y="106.262">1.00</text>
</g>
<polyline clip-path="url(#clip7102)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1478.89 158.266,1479.3 165.415,1477.81 172.564,1474.46 179.713,1469.83 186.862,1464.39 194.011,1457.88 201.16,1448.29 208.308,1437.07 215.457,1423.59 
  222.606,1407.41 229.755,1389.11 236.904,1369.06 244.053,1345.05 251.202,1318.88 258.351,1289.82 265.499,1258.89 272.648,1225.11 279.797,1189.78 286.946,1150.43 
  294.095,1112.16 301.244,1073.31 308.393,1031.91 315.542,987.771 322.69,940.197 329.839,891.847 336.988,839.546 344.137,785.376 351.286,729.312 358.435,672.679 
  365.584,618.436 372.733,564.626 379.881,513 387.03,464.685 394.179,417.253 401.328,371.762 408.477,329.464 415.626,290.053 422.775,251.771 429.924,217.807 
  437.072,188.172 444.221,162.898 451.37,141.803 458.519,124.067 465.668,109.488 472.817,98.6947 479.966,90.3407 487.115,94.477 494.263,97.7991 501.412,97.5999 
  508.561,95.5774 515.71,93.3661 522.859,91.4745 530.008,91.3194 537.157,92.565 544.306,94.1118 551.454,93.8203 558.603,92.3036 565.752,92.0963 572.901,90.9688 
  580.05,89.7628 587.199,91.4999 594.348,91.8 601.497,91.3792 608.645,90.9112 615.794,90.1694 622.943,90.2254 630.092,90.7355 637.241,90.4135 644.39,91.1357 
  651.539,91.3041 658.687,91.988 665.836,92.2258 672.985,92.5813 680.134,93.2881 687.283,94.3563 694.432,94.111 701.581,94 708.73,94.2022 715.878,94.9339 
  723.027,94.492 730.176,94.3408 737.325,95.2526 744.474,93.2817 751.623,93.6937 758.772,93.6395 765.921,92.4248 773.069,91.3546 780.218,90.3295 787.367,89.4064 
  794.516,89.2054 801.665,90.9875 808.814,91.5724 815.963,92.4065 823.112,92.9446 830.26,92.7858 837.409,91.9462 844.558,91.153 851.707,92.5551 858.856,91.6594 
  866.005,90.0839 873.154,89.4512 880.303,91.6121 887.451,92.0813 894.6,90.3394 901.749,90.6691 908.898,91.2652 916.047,91.3177 923.196,90.722 930.345,91.0477 
  937.494,91.0351 944.642,91.1422 951.791,92.0319 958.94,90.7727 966.089,90.1192 973.238,90.982 980.387,90.9448 987.536,91.6338 994.685,90.8629 1001.83,90.5297 
  1008.98,90.4004 1016.13,89.425 1023.28,90.1814 1030.43,89.7906 1037.58,91.467 1044.73,91.9629 1051.88,92.4573 1059.02,91.6779 1066.17,92.5378 1073.32,92.0487 
  1080.47,92.498 1087.62,93.4875 1094.77,90.8813 1101.92,90.8822 1109.07,91.4797 1116.22,90.2773 1123.36,89.7425 1130.51,90.2291 1137.66,90.6165 1144.81,91.2135 
  1151.96,91.4683 1159.11,90.6048 1166.26,90.6319 1173.41,90.7442 1180.56,90.8472 1187.7,90.6028 1194.85,89.4493 1202,89.2907 1209.15,90.4276 1216.3,89.6928 
  1223.45,89.3601 1230.6,91.064 1237.75,92.5165 1244.9,91.3225 1252.04,90.8275 1259.19,92.1238 1266.34,92.1339 1273.49,92.3366 1280.64,92.5315 1287.79,93.8044 
  1294.94,93.4183 1302.09,93.0721 1309.23,92.815 1316.38,92.1547 1323.53,91.8622 1330.68,91.6606 1337.83,89.7069 1344.98,90.5314 1352.13,91.1926 1359.28,91.0911 
  1366.43,90.754 1373.57,89.9738 1380.72,90.5542 1387.87,91.7943 1395.02,93.3951 1402.17,93.9261 1409.32,93.431 1416.47,93.4674 1423.62,92.7317 1430.77,91.7073 
  1437.91,92.6049 1445.06,93.0247 1452.21,91.5438 1459.36,91.2002 1466.51,90.7684 1473.66,91.1213 1480.81,90.2745 1487.96,89.0039 1495.11,91.4845 1502.25,92.709 
  1509.4,90.8917 1516.55,89.4471 1523.7,91.5615 1530.85,91.1059 1538,90.379 1545.15,89.5771 1552.3,90.0829 1559.45,90.246 1566.59,90.5153 1573.74,91.2323 
  1580.89,91.3474 1588.04,91.3036 1595.19,89.9202 1602.34,90.1764 1609.49,90.0795 1616.64,90.5051 1623.79,90.2347 1630.93,89.5976 1638.08,89.7193 1645.23,89.8183 
  1652.38,91.1934 1659.53,92.4623 1666.68,92.9123 1673.83,92.8417 1680.98,92.1362 1688.13,91.97 1695.27,91.4404 1702.42,90.7612 1709.57,91.3683 1716.72,92.2435 
  1723.87,91.5477 1731.02,91.0753 1738.17,90.5912 1745.32,91.5952 1752.47,90.1415 1759.61,90.3084 1766.76,91.7593 1773.91,90.9984 1781.06,90.081 1788.21,89.9317 
  1795.36,89.3906 1802.51,91.6697 1809.66,93.3713 1816.8,92.481 1823.95,92.219 1831.1,91.9256 1838.25,91.5807 1845.4,92.1958 1852.55,91.3339 1859.7,91.7976 
  1866.85,90.7672 1874,91.1296 1881.14,90.8106 1888.29,90.9509 1895.44,89.4224 1902.59,90.3366 1909.74,90.8937 1916.89,89.9525 1924.04,90.4822 1931.19,89.8509 
  1938.34,89.7123 1945.48,89.0244 1952.63,88.9544 1959.78,89.9504 1966.93,90.1426 1974.08,89.4871 1981.23,89.5952 1988.38,89.7342 1995.53,90.023 2002.68,89.2101 
  2009.82,89.7288 2016.97,90.1432 2024.12,91.7581 2031.27,93.099 2038.42,94.0635 2045.57,94.6974 2052.72,93.5018 2059.87,91.4286 2067.02,90.7977 2074.16,90.4485 
  2081.31,90.778 2088.46,89.7734 2095.61,90.09 2102.76,90.3519 2109.91,90.5306 2117.06,90.5505 2124.21,90.9918 2131.36,90.8246 2138.5,90.5722 2145.65,90.2906 
  2152.8,90.5739 2159.95,89.8497 2167.1,89.9681 2174.25,89.111 2181.4,90.6481 2188.55,90.106 2195.7,89.9865 2202.84,90.0086 2209.99,89.9276 2217.14,89.5221 
  2224.29,89.0288 2231.44,89.5848 2238.59,89.7876 2245.74,90.9325 2252.89,91.6998 2260.04,91.9918 2267.18,90.7115 2274.33,90.1929 2281.48,89.7837 2288.63,89.2606 
  
  "/>
<path clip-path="url(#clip7100)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip7100)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip7100)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip7100)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 15 January 2020 00:25">Wednesday 15 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
