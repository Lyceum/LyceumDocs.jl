<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 20,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 1000 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip7900">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip7900)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip7901">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip7900)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip7902">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip7902)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip7902)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip7902)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip7902)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip7902)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1479.3 2352.76,1479.3 
  "/>
<polyline clip-path="url(#clip7902)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.67 2352.76,1131.67 
  "/>
<polyline clip-path="url(#clip7902)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,784.051 2352.76,784.051 
  "/>
<polyline clip-path="url(#clip7902)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.428 2352.76,436.428 
  "/>
<polyline clip-path="url(#clip7902)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.8052 2352.76,88.8052 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1479.3 114.181,1479.3 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.67 114.181,1131.67 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,784.051 114.181,784.051 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.428 114.181,436.428 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.8052 114.181,88.8052 
  "/>
<g clip-path="url(#clip7900)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip7900)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip7900)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip7900)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip7900)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.8)" x="62.9921" y="1496.8">0.00</text>
</g>
<g clip-path="url(#clip7900)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1149.17)" x="62.9921" y="1149.17">0.25</text>
</g>
<g clip-path="url(#clip7900)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.551)" x="62.9921" y="801.551">0.50</text>
</g>
<g clip-path="url(#clip7900)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 453.928)" x="62.9921" y="453.928">0.75</text>
</g>
<g clip-path="url(#clip7900)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.305)" x="62.9921" y="106.305">1.00</text>
</g>
<polyline clip-path="url(#clip7902)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1479.3 158.266,1479.17 165.415,1477.96 172.564,1476.37 179.713,1473.73 186.862,1470.27 194.011,1466.26 201.16,1459.32 208.308,1448.26 215.457,1435.37 
  222.606,1420.1 229.755,1401.21 236.904,1379.45 244.053,1355.98 251.202,1328.47 258.351,1298.13 265.499,1265.11 272.648,1230.2 279.797,1193.12 286.946,1152.1 
  294.095,1106.98 301.244,1061.66 308.393,1014.6 315.542,968.563 322.69,920.246 329.839,869.544 336.988,815.044 344.137,757.821 351.286,700.781 358.435,643.274 
  365.584,588.4 372.733,537.064 379.881,484.433 387.03,433.959 394.179,384.369 401.328,338.994 408.477,297.016 415.626,258.053 422.775,223.018 429.924,192.424 
  437.072,166.077 444.221,144.033 451.37,126.326 458.519,112.949 465.668,103.094 472.817,99.2217 479.966,97.8926 487.115,98.3703 494.263,99.1663 501.412,99.1361 
  508.561,97.765 515.71,94.8418 522.859,92.259 530.008,90.4511 537.157,92.1447 544.306,91.8308 551.454,91.0895 558.603,90.4123 565.752,92.2965 572.901,92.4919 
  580.05,92.0512 587.199,90.8402 594.348,91.3453 601.497,92.4471 608.645,93.2051 615.794,93.6372 622.943,90.771 630.092,90.8312 637.241,90.5308 644.39,91.4988 
  651.539,91.7234 658.687,93.038 665.836,92.3284 672.985,92.0125 680.134,92.0092 687.283,89.214 694.432,90.8448 701.581,92.5659 708.73,93.2911 715.878,93.97 
  723.027,93.8153 730.176,92.8297 737.325,92.0442 744.474,92.4103 751.623,93.2772 758.772,93.3719 765.921,93.716 773.069,93.4693 780.218,94.8151 787.367,94.6072 
  794.516,91.3632 801.665,92.4311 808.814,93.9513 815.963,93.7955 823.112,93.0932 830.26,90.4522 837.409,90.5488 844.558,92.0658 851.707,91.9503 858.856,91.7568 
  866.005,91.9751 873.154,90.9068 880.303,88.9544 887.451,92.253 894.6,94.0085 901.749,96.2944 908.898,97.5726 916.047,96.2469 923.196,94.1043 930.345,92.9216 
  937.494,91.1722 944.642,90.7009 951.791,91.3838 958.94,91.6481 966.089,90.8805 973.238,89.9826 980.387,89.9925 987.536,89.8151 994.685,90.8653 1001.83,91.9336 
  1008.98,92.4639 1016.13,92.4343 1023.28,92.3229 1030.43,92.9558 1037.58,92.1318 1044.73,91.3229 1051.88,90.2748 1059.02,90.5114 1066.17,92.6528 1073.32,93.5314 
  1080.47,95.4525 1087.62,96.5488 1094.77,95.6777 1101.92,94.5129 1109.07,93.0034 1116.22,92.9421 1123.36,91.7934 1130.51,91.5245 1137.66,91.283 1144.81,89.6308 
  1151.96,90.2266 1159.11,91.5047 1166.26,91.8003 1173.41,90.4446 1180.56,90.1682 1187.7,91.8299 1194.85,92.4515 1202,91.1562 1209.15,90.1152 1216.3,90.2095 
  1223.45,90.724 1230.6,89.75 1237.75,90.1605 1244.9,89.9897 1252.04,90.9106 1259.19,90.684 1266.34,91.1438 1273.49,91.8632 1280.64,91.6006 1287.79,90.985 
  1294.94,91.3099 1302.09,91.0255 1309.23,89.3695 1316.38,90.0926 1323.53,90.1362 1330.68,89.852 1337.83,91.1627 1344.98,93.6428 1352.13,93.8613 1359.28,93.4937 
  1366.43,92.8053 1373.57,90.9003 1380.72,90.3148 1387.87,90.0888 1395.02,91.1545 1402.17,91.6212 1409.32,91.041 1416.47,91.3369 1423.62,92.9301 1430.77,93.6473 
  1437.91,92.4263 1445.06,91.4469 1452.21,91.6282 1459.36,92.081 1466.51,91.7051 1473.66,91.4898 1480.81,90.8619 1487.96,91.6368 1495.11,92.5118 1502.25,94.885 
  1509.4,94.4831 1516.55,92.765 1523.7,90.6512 1530.85,91.2544 1538,90.9118 1545.15,92.0791 1552.3,92.7895 1559.45,93.2951 1566.59,93.486 1573.74,90.8199 
  1580.89,89.848 1588.04,89.4191 1595.19,89.1545 1602.34,90.0459 1609.49,90.5357 1616.64,90.6051 1623.79,90.0701 1630.93,90.0835 1638.08,90.2924 1645.23,91.4964 
  1652.38,91.6423 1659.53,92.9514 1666.68,92.815 1673.83,93.0875 1680.98,92.8894 1688.13,92.7578 1695.27,91.4636 1702.42,90.3782 1709.57,90.5201 1716.72,90.9121 
  1723.87,91.4123 1731.02,92.3469 1738.17,91.8072 1745.32,90.6473 1752.47,89.199 1759.61,90.554 1766.76,92.2023 1773.91,91.6891 1781.06,91.6387 1788.21,90.1777 
  1795.36,90.0474 1802.51,90.7582 1809.66,91.0344 1816.8,90.7124 1823.95,89.9716 1831.1,89.0342 1838.25,90.0456 1845.4,91.7162 1852.55,91.6246 1859.7,91.9375 
  1866.85,90.5847 1874,90.5956 1881.14,91.1921 1888.29,91.0484 1895.44,90.9389 1902.59,89.6455 1909.74,89.8881 1916.89,89.2539 1924.04,89.6121 1931.19,90.8478 
  1938.34,90.0911 1945.48,91.7937 1952.63,92.8601 1959.78,94.1965 1966.93,93.9854 1974.08,93.4541 1981.23,93.8024 1988.38,93.6215 1995.53,94.4688 2002.68,94.4428 
  2009.82,93.8386 2016.97,94.4105 2024.12,93.6493 2031.27,93.4542 2038.42,93.3927 2045.57,91.9723 2052.72,92.5602 2059.87,90.2279 2067.02,89.7321 2074.16,90.7189 
  2081.31,91.0055 2088.46,91.3171 2095.61,91.2203 2102.76,92.2499 2109.91,93.7962 2117.06,93.084 2124.21,92.6203 2131.36,91.1653 2138.5,89.6629 2145.65,91.9488 
  2152.8,91.7706 2159.95,90.5142 2167.1,89.9803 2174.25,91.1175 2181.4,91.4473 2188.55,91.7803 2195.7,92.7543 2202.84,90.033 2209.99,89.5102 2217.14,90.8609 
  2224.29,92.2755 2231.44,92.8164 2238.59,91.4788 2245.74,91.4921 2252.89,91.4191 2260.04,90.4882 2267.18,90.9749 2274.33,90.8809 2281.48,91.092 2288.63,91.5363 
  
  "/>
<path clip-path="url(#clip7900)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip7900)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip7900)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip7900)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 14 January 2020 00:24">Tuesday 14 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
