<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li><li><a class="tocitem" href="../NPG/">Learning a control policy</a></li><li><a class="tocitem" href="../visualize/">Visualizing Results</a></li><li><a class="tocitem" href="../humanoid/">Creating a MuJoCo Environment</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 10,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 1000 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip9300">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip9300)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip9301">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip9300)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip9302">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip9302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip9302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip9302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip9302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip9302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1479.3 2352.76,1479.3 
  "/>
<polyline clip-path="url(#clip9302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.7 2352.76,1131.7 
  "/>
<polyline clip-path="url(#clip9302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,784.101 2352.76,784.101 
  "/>
<polyline clip-path="url(#clip9302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.502 2352.76,436.502 
  "/>
<polyline clip-path="url(#clip9302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.9035 2352.76,88.9035 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1479.3 114.181,1479.3 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.7 114.181,1131.7 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,784.101 114.181,784.101 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.502 114.181,436.502 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.9035 114.181,88.9035 
  "/>
<g clip-path="url(#clip9300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip9300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip9300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip9300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip9300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.8)" x="62.9921" y="1496.8">0.00</text>
</g>
<g clip-path="url(#clip9300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1149.2)" x="62.9921" y="1149.2">0.25</text>
</g>
<g clip-path="url(#clip9300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.601)" x="62.9921" y="801.601">0.50</text>
</g>
<g clip-path="url(#clip9300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 454.002)" x="62.9921" y="454.002">0.75</text>
</g>
<g clip-path="url(#clip9300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.403)" x="62.9921" y="106.403">1.00</text>
</g>
<polyline clip-path="url(#clip9302)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1479.3 158.266,1478.75 165.415,1477.51 172.564,1475.41 179.713,1471.52 186.862,1465.47 194.011,1456.73 201.16,1446.3 208.308,1433.95 215.457,1418.48 
  222.606,1401.86 229.755,1382.57 236.904,1361.76 244.053,1339.83 251.202,1317.45 258.351,1293.5 265.499,1268.43 272.648,1241.01 279.797,1210.76 286.946,1178.47 
  294.095,1144.87 301.244,1109.8 308.393,1073.89 315.542,1037.78 322.69,999.563 329.839,960.155 336.988,919.267 344.137,875.693 351.286,829.764 358.435,782.568 
  365.584,732.646 372.733,682.538 379.881,631.13 387.03,578.764 394.179,525.538 401.328,472.393 408.477,418.512 415.626,365.851 422.775,313.532 429.924,263.001 
  437.072,214.527 444.221,167.943 451.37,128.546 458.519,127.687 465.668,162.654 472.817,201.931 479.966,239.677 487.115,275.494 494.263,309.791 501.412,342.323 
  508.561,372.338 515.71,400.135 522.859,428.099 530.008,454.348 537.157,479.243 544.306,502.649 551.454,524.77 558.603,544.524 565.752,562.381 572.901,578.997 
  580.05,595.166 587.199,610.988 594.348,626.399 601.497,641.456 608.645,656.329 615.794,655.533 622.943,653.145 630.092,648.598 637.241,641.396 644.39,632.476 
  651.539,620.96 658.687,608.837 665.836,595.855 672.985,581.156 680.134,564.638 687.283,547.133 694.432,528.072 701.581,507.315 708.73,484.396 715.878,460.176 
  723.027,433.995 730.176,406.364 737.325,376.437 744.474,346.289 751.623,316.033 758.772,285.203 765.921,253.524 773.069,221.899 780.218,191.308 787.367,161.602 
  794.516,133.784 801.665,108.139 808.814,93.5759 815.963,115.512 823.112,136.103 830.26,155.31 837.409,172.686 844.558,188.554 851.707,202.438 858.856,214.196 
  866.005,223.273 873.154,230.851 880.303,237.016 887.451,240.29 894.6,242.183 901.749,242.946 908.898,241.337 916.047,239.503 923.196,235.518 930.345,230.93 
  937.494,224.955 944.642,217.455 951.791,209.502 958.94,199.688 966.089,188.358 973.238,175.676 980.387,163.289 987.536,150.343 994.685,137.71 1001.83,126.234 
  1008.98,116.175 1016.13,107.445 1023.28,100.338 1030.43,95.0512 1037.58,91.68 1044.73,91.3447 1051.88,92.5304 1059.02,93.1962 1066.17,93.1742 1073.32,92.2296 
  1080.47,90.9538 1087.62,90.3742 1094.77,90.1847 1101.92,90.5844 1109.07,90.6481 1116.22,90.2963 1123.36,90.072 1130.51,89.5775 1137.66,89.4641 1144.81,89.4384 
  1151.96,89.1641 1159.11,89.7058 1166.26,89.7583 1173.41,89.6032 1180.56,89.5701 1187.7,89.1981 1194.85,89.4937 1202,89.9752 1209.15,90.0483 1216.3,90.2508 
  1223.45,90.4138 1230.6,90.0247 1237.75,89.4761 1244.9,89.026 1252.04,89.2235 1259.19,89.383 1266.34,88.9582 1273.49,89.2771 1280.64,89.2031 1287.79,89.3405 
  1294.94,89.668 1302.09,89.9021 1309.23,89.8998 1316.38,89.8228 1323.53,89.6062 1330.68,89.5569 1337.83,89.2251 1344.98,89.0047 1352.13,89.271 1359.28,89.0432 
  1366.43,89.0866 1373.57,89.0959 1380.72,89.4444 1387.87,89.3427 1395.02,89.08 1402.17,89.0839 1409.32,89.1293 1416.47,88.9544 1423.62,89.2325 1430.77,89.6818 
  1437.91,89.8428 1445.06,89.9776 1452.21,90.0892 1459.36,90.1988 1466.51,89.7475 1473.66,89.6711 1480.81,89.491 1487.96,89.7277 1495.11,89.5335 1502.25,89.4249 
  1509.4,89.3409 1516.55,89.3824 1523.7,89.8253 1530.85,90.043 1538,90.0394 1545.15,90.031 1552.3,89.9985 1559.45,89.7342 1566.59,89.4414 1573.74,89.3006 
  1580.89,89.4104 1588.04,89.4235 1595.19,89.677 1602.34,89.8535 1609.49,89.9216 1616.64,89.9025 1623.79,90.1925 1630.93,90.3578 1638.08,90.0919 1645.23,90.2222 
  1652.38,90.327 1659.53,90.3604 1666.68,89.8514 1673.83,89.4925 1680.98,89.2106 1688.13,89.4847 1695.27,89.2658 1702.42,89.2778 1709.57,89.3625 1716.72,89.7153 
  1723.87,89.7681 1731.02,90.1392 1738.17,90.0575 1745.32,89.8847 1752.47,89.4406 1759.61,89.6034 1766.76,89.5992 1773.91,89.721 1781.06,89.717 1788.21,89.5978 
  1795.36,89.4377 1802.51,89.4509 1809.66,89.3294 1816.8,89.6009 1823.95,90.1438 1831.1,89.8126 1838.25,89.1197 1845.4,89.3529 1852.55,89.5565 1859.7,89.3052 
  1866.85,89.4732 1874,89.1445 1881.14,89.0283 1888.29,89.4217 1895.44,89.5362 1902.59,89.4968 1909.74,89.6888 1916.89,89.5893 1924.04,89.8736 1931.19,90.3033 
  1938.34,90.0894 1945.48,89.9417 1952.63,89.6733 1959.78,89.2407 1966.93,89.4067 1974.08,89.4123 1981.23,89.6257 1988.38,89.7869 1995.53,90.0544 2002.68,90.0783 
  2009.82,89.3836 2016.97,89.0996 2024.12,89.2745 2031.27,89.3486 2038.42,89.0906 2045.57,89.2425 2052.72,90.0703 2059.87,90.819 2067.02,90.4703 2074.16,90.1626 
  2081.31,90.0371 2088.46,89.8317 2095.61,89.3814 2102.76,89.5814 2109.91,89.7071 2117.06,89.9929 2124.21,89.3986 2131.36,89.6689 2138.5,89.2351 2145.65,89.7911 
  2152.8,89.718 2159.95,89.5476 2167.1,89.8816 2174.25,89.9476 2181.4,89.6491 2188.55,89.2551 2195.7,89.3495 2202.84,89.53 2209.99,89.5367 2217.14,89.4869 
  2224.29,89.0396 2231.44,89.467 2238.59,89.48 2245.74,89.1999 2252.89,89.1995 2260.04,89.052 2267.18,89.145 2274.33,89.0893 2281.48,89.2544 2288.63,89.3639 
  
  "/>
<path clip-path="url(#clip9300)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip9300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip9300)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip9300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../NPG/">Learning a control policy »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 January 2020 20:04">Monday 13 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
