<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li><li><a class="tocitem" href="../NPG/">Learning a control policy</a></li><li><a class="tocitem" href="../visualize/">Visualizing Results</a></li><li><a class="tocitem" href="../humanoid/">Creating a MuJoCo Environment</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 10,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 1000 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip4200">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip4200)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip4201">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip4200)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip4202">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip4202)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip4202)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip4202)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip4202)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip4202)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1479.3 2352.76,1479.3 
  "/>
<polyline clip-path="url(#clip4202)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.7 2352.76,1131.7 
  "/>
<polyline clip-path="url(#clip4202)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,784.104 2352.76,784.104 
  "/>
<polyline clip-path="url(#clip4202)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.507 2352.76,436.507 
  "/>
<polyline clip-path="url(#clip4202)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.9096 2352.76,88.9096 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1479.3 114.181,1479.3 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.7 114.181,1131.7 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,784.104 114.181,784.104 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.507 114.181,436.507 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.9096 114.181,88.9096 
  "/>
<g clip-path="url(#clip4200)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip4200)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip4200)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip4200)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip4200)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.8)" x="62.9921" y="1496.8">0.00</text>
</g>
<g clip-path="url(#clip4200)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1149.2)" x="62.9921" y="1149.2">0.25</text>
</g>
<g clip-path="url(#clip4200)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.604)" x="62.9921" y="801.604">0.50</text>
</g>
<g clip-path="url(#clip4200)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 454.007)" x="62.9921" y="454.007">0.75</text>
</g>
<g clip-path="url(#clip4200)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.41)" x="62.9921" y="106.41">1.00</text>
</g>
<polyline clip-path="url(#clip4202)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1479.3 158.266,1478.76 165.415,1477.73 172.564,1475.24 179.713,1472.23 186.862,1467.75 194.011,1461.8 201.16,1454.47 208.308,1445.52 215.457,1434.72 
  222.606,1423.45 229.755,1411.1 236.904,1397.17 244.053,1381.32 251.202,1364.59 258.351,1346.51 265.499,1326.47 272.648,1305.17 279.797,1283.35 286.946,1260.58 
  294.095,1236.39 301.244,1211.39 308.393,1184.51 315.542,1153.78 322.69,1120.01 329.839,1083.02 336.988,1044.81 344.137,1003.87 351.286,961.959 358.435,917.833 
  365.584,873.867 372.733,828.285 379.881,781.981 387.03,733.645 394.179,684.386 401.328,633.11 408.477,580.728 415.626,528.147 422.775,475.572 429.924,422.461 
  437.072,369.964 444.221,317.892 451.37,266.959 458.519,216.509 465.668,168.959 472.817,130.67 479.966,129.688 487.115,163.85 494.263,203.074 501.412,242.682 
  508.561,280.863 515.71,317.106 522.859,351.625 530.008,384.855 537.157,416.591 544.306,446.272 551.454,475.045 558.603,501.755 565.752,527.028 572.901,551.986 
  580.05,575.446 587.199,597.309 594.348,619.51 601.497,640.885 608.645,662.073 615.794,657.972 622.943,651.35 630.092,642.914 637.241,633.987 644.39,621.807 
  651.539,607.581 658.687,591.885 665.836,573.797 672.985,553.7 680.134,532.19 687.283,509.901 694.432,486.593 701.581,460.834 708.73,433.195 715.878,404.387 
  723.027,373.821 730.176,341.262 737.325,308.283 744.474,275.893 751.623,242.68 758.772,209.114 765.921,176.604 773.069,145.8 780.218,117.551 787.367,92.3331 
  794.516,110.682 801.665,132.319 808.814,151.705 815.963,169.729 823.112,184.987 830.26,198.4 837.409,211.048 844.558,222.611 851.707,232.25 858.856,239.915 
  866.005,245.984 873.154,251.012 880.303,255.521 887.451,258.899 894.6,260.94 901.749,262.194 908.898,260.425 916.047,257.13 923.196,252.751 930.345,247.121 
  937.494,240.701 944.642,233.931 951.791,226.402 958.94,217.616 966.089,206.904 973.238,195.103 980.387,183.798 987.536,172.306 994.685,159.419 1001.83,146.183 
  1008.98,133.339 1016.13,122.097 1023.28,112.773 1030.43,105.45 1037.58,100.248 1044.73,96.5829 1051.88,94.7632 1059.02,92.1455 1066.17,91.3871 1073.32,91.8377 
  1080.47,91.4811 1087.62,90.4921 1094.77,90.0291 1101.92,89.5789 1109.07,89.5519 1116.22,89.1823 1123.36,89.2194 1130.51,89.2996 1137.66,89.8211 1144.81,89.4788 
  1151.96,89.3273 1159.11,89.3329 1166.26,89.1952 1173.41,89.1278 1180.56,89.1193 1187.7,89.2972 1194.85,89.4099 1202,89.2789 1209.15,89.4907 1216.3,89.8073 
  1223.45,89.7606 1230.6,89.5659 1237.75,89.2399 1244.9,89.2558 1252.04,89.2572 1259.19,89.0224 1266.34,89.1908 1273.49,89.3405 1280.64,89.2598 1287.79,89.3639 
  1294.94,89.4596 1302.09,89.1572 1309.23,89.114 1316.38,89.8404 1323.53,90.3242 1330.68,90.0282 1337.83,89.504 1344.98,89.4697 1352.13,89.3631 1359.28,89.2971 
  1366.43,88.9544 1373.57,89.2342 1380.72,89.3126 1387.87,89.1846 1395.02,89.2238 1402.17,89.0333 1409.32,89.4346 1416.47,89.7938 1423.62,89.91 1430.77,90.0087 
  1437.91,90.0512 1445.06,89.9741 1452.21,89.3016 1459.36,89.1816 1466.51,89.2095 1473.66,89.4014 1480.81,89.4571 1487.96,89.3679 1495.11,89.6673 1502.25,89.7266 
  1509.4,89.6931 1516.55,89.3827 1523.7,89.3113 1530.85,89.2379 1538,89.5316 1545.15,89.7431 1552.3,89.5851 1559.45,89.2683 1566.59,89.0406 1573.74,89.1131 
  1580.89,89.2249 1588.04,89.6725 1595.19,89.6327 1602.34,89.6877 1609.49,90.3433 1616.64,91.0663 1623.79,91.0872 1630.93,90.6565 1638.08,90.444 1645.23,90.2993 
  1652.38,89.5064 1659.53,89.6354 1666.68,89.4132 1673.83,89.3253 1680.98,89.4836 1688.13,89.9457 1695.27,90.1159 1702.42,90.1797 1709.57,89.7993 1716.72,89.5777 
  1723.87,89.4842 1731.02,89.3846 1738.17,89.1714 1745.32,89.1815 1752.47,89.2297 1759.61,89.1617 1766.76,89.3232 1773.91,89.284 1781.06,89.1729 1788.21,89.0696 
  1795.36,89.2869 1802.51,89.4001 1809.66,89.5253 1816.8,89.3879 1823.95,89.2972 1831.1,89.6343 1838.25,89.9609 1845.4,89.6508 1852.55,90.0859 1859.7,89.8351 
  1866.85,89.5359 1874,89.3081 1881.14,89.2343 1888.29,89.2393 1895.44,89.6485 1902.59,89.585 1909.74,89.6033 1916.89,89.7125 1924.04,89.7817 1931.19,89.7782 
  1938.34,89.6186 1945.48,89.5547 1952.63,89.6528 1959.78,89.2465 1966.93,89.0843 1974.08,89.3045 1981.23,89.1784 1988.38,89.0769 1995.53,89.3789 2002.68,89.6265 
  2009.82,89.7481 2016.97,89.5936 2024.12,89.4685 2031.27,89.5301 2038.42,89.4561 2045.57,89.5686 2052.72,90.2437 2059.87,90.5704 2067.02,90.2941 2074.16,90.315 
  2081.31,89.7343 2088.46,89.8745 2095.61,89.9318 2102.76,89.7188 2109.91,89.3064 2117.06,88.9744 2124.21,89.6216 2131.36,89.5785 2138.5,89.5316 2145.65,89.8727 
  2152.8,90.1487 2159.95,89.778 2167.1,89.6145 2174.25,89.1439 2181.4,89.0724 2188.55,89.1256 2195.7,89.4001 2202.84,89.8406 2209.99,89.8603 2217.14,89.778 
  2224.29,89.7593 2231.44,89.5451 2238.59,89.2836 2245.74,89.3012 2252.89,89.0571 2260.04,89.3893 2267.18,89.4795 2274.33,89.4463 2281.48,89.9176 2288.63,89.9655 
  
  "/>
<path clip-path="url(#clip4200)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip4200)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip4200)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip4200)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../NPG/">Learning a control policy »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 January 2020 04:22">Monday 13 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
