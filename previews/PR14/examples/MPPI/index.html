<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li><li><a class="tocitem" href="../NPG/">Learning a control policy</a></li><li><a class="tocitem" href="../visualize/">Visualizing Results</a></li><li><a class="tocitem" href="../humanoid/">Creating a MuJoCo Environment</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 10,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 1000 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip7800">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip7800)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip7801">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip7800)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip7802">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip7802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip7802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip7802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip7802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip7802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1479.3 2352.76,1479.3 
  "/>
<polyline clip-path="url(#clip7802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.7 2352.76,1131.7 
  "/>
<polyline clip-path="url(#clip7802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,784.098 2352.76,784.098 
  "/>
<polyline clip-path="url(#clip7802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.499 2352.76,436.499 
  "/>
<polyline clip-path="url(#clip7802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.8992 2352.76,88.8992 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1479.3 114.181,1479.3 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.7 114.181,1131.7 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,784.098 114.181,784.098 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.499 114.181,436.499 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.8992 114.181,88.8992 
  "/>
<g clip-path="url(#clip7800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip7800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip7800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip7800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip7800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.8)" x="62.9921" y="1496.8">0.00</text>
</g>
<g clip-path="url(#clip7800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1149.2)" x="62.9921" y="1149.2">0.25</text>
</g>
<g clip-path="url(#clip7800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.598)" x="62.9921" y="801.598">0.50</text>
</g>
<g clip-path="url(#clip7800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 453.999)" x="62.9921" y="453.999">0.75</text>
</g>
<g clip-path="url(#clip7800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.399)" x="62.9921" y="106.399">1.00</text>
</g>
<polyline clip-path="url(#clip7802)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1479.3 158.266,1478.71 165.415,1477.26 172.564,1474.62 179.713,1470.49 186.862,1464.51 194.011,1457 201.16,1448.05 208.308,1438.46 215.457,1426.59 
  222.606,1413.46 229.755,1399.79 236.904,1384.23 244.053,1367.31 251.202,1349.95 258.351,1330.71 265.499,1309.21 272.648,1285.1 279.797,1258.99 286.946,1231.57 
  294.095,1201.11 301.244,1168.72 308.393,1134.55 315.542,1098.34 322.69,1060.44 329.839,1021.08 336.988,980.753 344.137,939.389 351.286,897.548 358.435,853.645 
  365.584,808.061 372.733,761.167 379.881,712.401 387.03,662.239 394.179,610.519 401.328,557.914 408.477,504.969 415.626,450.634 422.775,395.67 429.924,340.121 
  437.072,285.534 444.221,232.611 451.37,181.597 458.519,132.112 465.668,97.1511 472.817,138.532 479.966,181.195 487.115,222.269 494.263,262.472 501.412,300.761 
  508.561,336.257 515.71,369.79 522.859,400.849 530.008,430.826 537.157,459.636 544.306,487.338 551.454,514.707 558.603,540.284 565.752,563.133 572.901,585.227 
  580.05,606.98 587.199,628.385 594.348,648.716 601.497,647.924 608.645,645.379 615.794,640.702 622.943,634.877 630.092,626.663 637.241,617.366 644.39,607.138 
  651.539,595.513 658.687,581.963 665.836,566.39 672.985,549.525 680.134,530.623 687.283,510.261 694.432,489.983 701.581,467.254 708.73,443.896 715.878,418.576 
  723.027,391.178 730.176,361.655 737.325,332.071 744.474,301.367 751.623,269.975 758.772,237.968 765.921,207.133 773.069,177.582 780.218,148.596 787.367,121.383 
  794.516,97.0613 801.665,108.679 808.814,131.589 815.963,152.851 823.112,171.836 830.26,189.956 837.409,205.927 844.558,220.223 851.707,233.703 858.856,244.861 
  866.005,253.725 873.154,261.008 880.303,266.289 887.451,269.115 894.6,270.125 901.749,267.533 908.898,263.377 916.047,258.14 923.196,251.949 930.345,244.516 
  937.494,235.932 944.642,225.356 951.791,212.818 958.94,198.916 966.089,184.583 973.238,169.525 980.387,154.628 987.536,139.853 994.685,126.244 1001.83,113.621 
  1008.98,102.704 1016.13,94.6467 1023.28,90.685 1030.43,94.3474 1037.58,97.4864 1044.73,99.4162 1051.88,99.6145 1059.02,99.4165 1066.17,97.8955 1073.32,95.6367 
  1080.47,93.5293 1087.62,91.4521 1094.77,90.0133 1101.92,89.5683 1109.07,89.3338 1116.22,89.1626 1123.36,89.2088 1130.51,89.0875 1137.66,89.4811 1144.81,89.4248 
  1151.96,89.5007 1159.11,89.4387 1166.26,89.2332 1173.41,89.5532 1180.56,89.6176 1187.7,89.2056 1194.85,89.3494 1202,89.3332 1209.15,89.3355 1216.3,89.2417 
  1223.45,89.7271 1230.6,89.6227 1237.75,90.3592 1244.9,91.1055 1252.04,91.2825 1259.19,90.7165 1266.34,90.5004 1273.49,90.3128 1280.64,90.524 1287.79,89.944 
  1294.94,89.9888 1302.09,89.6897 1309.23,89.2031 1316.38,89.4965 1323.53,89.5303 1330.68,89.1434 1337.83,89.8093 1344.98,90.1492 1352.13,90.0472 1359.28,90.0837 
  1366.43,90.2799 1373.57,89.8944 1380.72,89.3169 1387.87,89.667 1395.02,89.266 1402.17,89.3395 1409.32,89.4979 1416.47,89.8543 1423.62,90.3015 1430.77,90.5374 
  1437.91,90.4364 1445.06,89.7733 1452.21,89.119 1459.36,89.3772 1466.51,89.2565 1473.66,89.0334 1480.81,89.391 1487.96,89.693 1495.11,89.9266 1502.25,89.4199 
  1509.4,89.1997 1516.55,89.2249 1523.7,89.417 1530.85,89.7802 1538,90.012 1545.15,90.1108 1552.3,90.0543 1559.45,89.8193 1566.59,89.3639 1573.74,89.2286 
  1580.89,89.057 1588.04,89.3415 1595.19,89.7253 1602.34,89.9124 1609.49,89.8189 1616.64,89.3766 1623.79,89.1784 1630.93,89.1119 1638.08,89.536 1645.23,89.5894 
  1652.38,89.1514 1659.53,89.4267 1666.68,89.0115 1673.83,89.2037 1680.98,89.4227 1688.13,89.6132 1695.27,90.0063 1702.42,90.3048 1709.57,90.0517 1716.72,89.592 
  1723.87,89.5917 1731.02,89.5284 1738.17,89.5815 1745.32,89.9881 1752.47,90.1237 1759.61,89.8474 1766.76,89.6752 1773.91,89.7498 1781.06,89.7182 1788.21,89.664 
  1795.36,89.8095 1802.51,89.5414 1809.66,89.1026 1816.8,89.3492 1823.95,89.6731 1831.1,89.302 1838.25,89.4124 1845.4,89.5172 1852.55,89.8768 1859.7,90.1966 
  1866.85,90.0168 1874,89.9022 1881.14,89.8402 1888.29,89.6072 1895.44,89.439 1902.59,89.3831 1909.74,89.4142 1916.89,89.0651 1924.04,89.4047 1931.19,89.9145 
  1938.34,90.1037 1945.48,90.0854 1952.63,90.0868 1959.78,90.3485 1966.93,89.8279 1974.08,89.2737 1981.23,89.4479 1988.38,89.4268 1995.53,89.7234 2002.68,89.9736 
  2009.82,89.9935 2016.97,89.8636 2024.12,89.609 2031.27,89.5664 2038.42,89.5128 2045.57,89.5912 2052.72,89.8689 2059.87,90.3095 2067.02,90.4224 2074.16,90.2023 
  2081.31,90.2688 2088.46,89.8889 2095.61,89.4112 2102.76,89.5853 2109.91,90.0164 2117.06,89.8914 2124.21,89.9073 2131.36,89.3565 2138.5,89.2578 2145.65,88.9544 
  2152.8,89.6197 2159.95,89.7655 2167.1,89.9636 2174.25,89.9893 2181.4,89.8166 2188.55,89.7212 2195.7,89.6865 2202.84,89.8907 2209.99,89.294 2217.14,89.0053 
  2224.29,89.2602 2231.44,89.5343 2238.59,89.5669 2245.74,89.7876 2252.89,89.7241 2260.04,89.668 2267.18,89.9331 2274.33,89.9125 2281.48,89.9608 2288.63,89.5341 
  
  "/>
<path clip-path="url(#clip7800)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip7800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip7800)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip7800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../NPG/">Learning a control policy »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 January 2020 04:26">Monday 13 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
