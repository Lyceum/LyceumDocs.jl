<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li><li><a class="tocitem" href="../NPG/">Learning a control policy</a></li><li><a class="tocitem" href="../visualize/">Visualizing Results</a></li><li><a class="tocitem" href="../humanoid/">Creating a MuJoCo Environment</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 10,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 1000 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip2300">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip2300)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip2301">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip2300)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip2302">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip2302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip2302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip2302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip2302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip2302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1479.3 2352.76,1479.3 
  "/>
<polyline clip-path="url(#clip2302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.69 2352.76,1131.69 
  "/>
<polyline clip-path="url(#clip2302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,784.086 2352.76,784.086 
  "/>
<polyline clip-path="url(#clip2302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.481 2352.76,436.481 
  "/>
<polyline clip-path="url(#clip2302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.8751 2352.76,88.8751 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1479.3 114.181,1479.3 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.69 114.181,1131.69 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,784.086 114.181,784.086 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.481 114.181,436.481 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.8751 114.181,88.8751 
  "/>
<g clip-path="url(#clip2300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip2300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip2300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip2300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip2300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.8)" x="62.9921" y="1496.8">0.00</text>
</g>
<g clip-path="url(#clip2300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1149.19)" x="62.9921" y="1149.19">0.25</text>
</g>
<g clip-path="url(#clip2300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.586)" x="62.9921" y="801.586">0.50</text>
</g>
<g clip-path="url(#clip2300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 453.981)" x="62.9921" y="453.981">0.75</text>
</g>
<g clip-path="url(#clip2300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.375)" x="62.9921" y="106.375">1.00</text>
</g>
<polyline clip-path="url(#clip2302)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1479.3 158.266,1478.93 165.415,1477.74 172.564,1475.63 179.713,1472.84 186.862,1468.71 194.011,1463.43 201.16,1455.46 208.308,1445.49 215.457,1433.28 
  222.606,1419.74 229.755,1404.66 236.904,1387.4 244.053,1368.38 251.202,1347.87 258.351,1326.12 265.499,1302.59 272.648,1276.74 279.797,1248.2 286.946,1217.32 
  294.095,1185.39 301.244,1151.85 308.393,1117.05 315.542,1080.38 322.69,1042.26 329.839,1003.77 336.988,963.779 344.137,921.499 351.286,877.451 358.435,831.667 
  365.584,784.585 372.733,736.057 379.881,687.368 387.03,636.381 394.179,584.538 401.328,532.414 408.477,478.904 415.626,425.612 422.775,372.835 429.924,320.096 
  437.072,268.178 444.221,219.116 451.37,172.848 458.519,138.383 465.668,138.596 472.817,169.716 479.966,208.427 487.115,247.846 494.263,286.538 501.412,323.831 
  508.561,359.857 515.71,394.262 522.859,426.613 530.008,457.73 537.157,487.687 544.306,517.224 551.454,546.151 558.603,572.825 565.752,599.44 572.901,626.195 
  580.05,652.382 587.199,651.114 594.348,647.26 601.497,641.598 608.645,633.968 615.794,624.726 622.943,612.38 630.092,599.301 637.241,584.362 644.39,566.596 
  651.539,546.792 658.687,524.817 665.836,501.999 672.985,478.4 680.134,451.673 687.283,423.593 694.432,394.128 701.581,361.854 708.73,328.096 715.878,293.63 
  723.027,258.314 730.176,223.905 737.325,190.34 744.474,159.082 751.623,129.676 758.772,102.519 765.921,103.697 773.069,127.041 780.218,148.81 787.367,170.087 
  794.516,190.225 801.665,208.308 808.814,223.436 815.963,237.452 823.112,248.494 830.26,257.739 837.409,264.164 844.558,268.968 851.707,272.149 858.856,273.491 
  866.005,272.63 873.154,269.651 880.303,265.504 887.451,258.774 894.6,251.169 901.749,242.43 908.898,232.059 916.047,219.309 923.196,204.066 930.345,188.868 
  937.494,173.272 944.642,157.922 951.791,142.907 958.94,128.616 966.089,115.8 973.238,105.159 980.387,97.2465 987.536,91.9556 994.685,89.7333 1001.83,91.8901 
  1008.98,92.7666 1016.13,93.1479 1023.28,93.1438 1030.43,92.375 1037.58,91.3733 1044.73,90.1297 1051.88,89.3964 1059.02,89.3476 1066.17,89.6198 1073.32,89.6956 
  1080.47,89.6699 1087.62,89.461 1094.77,89.4608 1101.92,89.4914 1109.07,89.7188 1116.22,89.5443 1123.36,89.5169 1130.51,89.1778 1137.66,88.9945 1144.81,89.3433 
  1151.96,89.1561 1159.11,89.3337 1166.26,89.4013 1173.41,89.407 1180.56,89.401 1187.7,89.5093 1194.85,89.7224 1202,89.7861 1209.15,89.0767 1216.3,89.1234 
  1223.45,89.3988 1230.6,89.8178 1237.75,90.0617 1244.9,90.1761 1252.04,89.8192 1259.19,89.7595 1266.34,89.5476 1273.49,89.5026 1280.64,89.8655 1287.79,90.1084 
  1294.94,90.1525 1302.09,89.9514 1309.23,89.8005 1316.38,89.7255 1323.53,89.7082 1330.68,89.202 1337.83,89.0977 1344.98,89.302 1352.13,89.5191 1359.28,89.4561 
  1366.43,89.4102 1373.57,89.2422 1380.72,89.1501 1387.87,89.095 1395.02,89.0181 1402.17,89.1485 1409.32,89.0475 1416.47,88.9697 1423.62,89.2706 1430.77,88.9562 
  1437.91,89.3128 1445.06,89.559 1452.21,89.8551 1459.36,89.9821 1466.51,90.1219 1473.66,90.1392 1480.81,89.6847 1487.96,89.0652 1495.11,89.3524 1502.25,89.222 
  1509.4,89.3106 1516.55,89.0532 1523.7,89.1846 1530.85,89.0601 1538,89.2889 1545.15,89.5869 1552.3,89.2505 1559.45,89.1648 1566.59,89.2546 1573.74,89.7313 
  1580.89,89.9998 1588.04,89.9123 1595.19,90.0111 1602.34,90.0554 1609.49,89.7591 1616.64,89.4152 1623.79,89.6019 1630.93,89.7058 1638.08,89.5957 1645.23,89.4752 
  1652.38,89.472 1659.53,89.4382 1666.68,89.4465 1673.83,89.9655 1680.98,90.1869 1688.13,89.776 1695.27,89.0844 1702.42,89.5329 1709.57,89.9107 1716.72,90.0469 
  1723.87,89.9973 1731.02,89.8996 1738.17,89.667 1745.32,89.7903 1752.47,89.2046 1759.61,89.176 1766.76,89.4402 1773.91,89.1704 1781.06,89.0133 1788.21,89.0289 
  1795.36,88.995 1802.51,89.3206 1809.66,89.4037 1816.8,89.3382 1823.95,89.5005 1831.1,89.398 1838.25,89.0693 1845.4,89.4118 1852.55,89.3574 1859.7,89.3408 
  1866.85,89.3023 1874,89.5337 1881.14,89.6978 1888.29,90.1217 1895.44,90.8152 1902.59,90.4374 1909.74,89.8761 1916.89,89.428 1924.04,89.5375 1931.19,89.6424 
  1938.34,89.163 1945.48,89.3073 1952.63,89.2487 1959.78,89.2278 1966.93,89.1915 1974.08,89.0679 1981.23,89.2445 1988.38,89.1683 1995.53,89.235 2002.68,89.4295 
  2009.82,89.4937 2016.97,89.2004 2024.12,89.2159 2031.27,89.1784 2038.42,89.2284 2045.57,89.2273 2052.72,89.5362 2059.87,89.4144 2067.02,89.5435 2074.16,89.7849 
  2081.31,89.5826 2088.46,89.3377 2095.61,89.4066 2102.76,89.1989 2109.91,89.3547 2117.06,89.6246 2124.21,89.8877 2131.36,90.1028 2138.5,90.4207 2145.65,90.9405 
  2152.8,90.7518 2159.95,90.4053 2167.1,89.8856 2174.25,89.3682 2181.4,88.9544 2188.55,88.9923 2195.7,89.3253 2202.84,90.0645 2209.99,90.3205 2217.14,90.3375 
  2224.29,90.3146 2231.44,90.0339 2238.59,89.8764 2245.74,89.828 2252.89,89.6239 2260.04,89.4204 2267.18,89.3637 2274.33,89.6161 2281.48,89.8315 2288.63,89.4871 
  
  "/>
<path clip-path="url(#clip2300)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip2300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip2300)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip2300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../NPG/">Learning a control policy »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 January 2020 02:52">Monday 13 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
