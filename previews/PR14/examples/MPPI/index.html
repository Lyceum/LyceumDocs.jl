<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li><li><a class="tocitem" href="../NPG/">Learning a control policy</a></li><li><a class="tocitem" href="../visualize/">Visualizing Results</a></li><li><a class="tocitem" href="../humanoid/">Creating a MuJoCo Environment</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 20,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 300 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip8800">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip8800)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip8801">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip8800)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip8802">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip8802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip8802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip8802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip8802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip8802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1479.3 2352.76,1479.3 
  "/>
<polyline clip-path="url(#clip8802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.67 2352.76,1131.67 
  "/>
<polyline clip-path="url(#clip8802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,784.04 2352.76,784.04 
  "/>
<polyline clip-path="url(#clip8802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.411 2352.76,436.411 
  "/>
<polyline clip-path="url(#clip8802)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.782 2352.76,88.782 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1479.3 114.181,1479.3 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.67 114.181,1131.67 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,784.04 114.181,784.04 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.411 114.181,436.411 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.782 114.181,88.782 
  "/>
<g clip-path="url(#clip8800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip8800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip8800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip8800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip8800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.8)" x="62.9921" y="1496.8">0.00</text>
</g>
<g clip-path="url(#clip8800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1149.17)" x="62.9921" y="1149.17">0.25</text>
</g>
<g clip-path="url(#clip8800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.54)" x="62.9921" y="801.54">0.50</text>
</g>
<g clip-path="url(#clip8800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 453.911)" x="62.9921" y="453.911">0.75</text>
</g>
<g clip-path="url(#clip8800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.282)" x="62.9921" y="106.282">1.00</text>
</g>
<polyline clip-path="url(#clip8802)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1479.3 158.266,1479.11 165.415,1477.55 172.564,1474.9 179.713,1470.02 186.862,1461.76 194.011,1451.38 201.16,1438.66 208.308,1423.68 215.457,1407.37 
  222.606,1389.23 229.755,1368.34 236.904,1346.89 244.053,1322.41 251.202,1294.84 258.351,1264.13 265.499,1231.88 272.648,1197.98 279.797,1161.27 286.946,1120.82 
  294.095,1076.34 301.244,1029.74 308.393,979.112 315.542,925.736 322.69,869.939 329.839,812.164 336.988,754.319 344.137,696.645 351.286,640.738 358.435,587.091 
  365.584,534.149 372.733,482.037 379.881,431.378 387.03,385.064 394.179,340.838 401.328,298.854 408.477,260.396 415.626,226.221 422.775,195.102 429.924,168.206 
  437.072,144.727 444.221,125.621 451.37,110.728 458.519,109.203 465.668,116.129 472.817,123.74 479.966,129.343 487.115,133.364 494.263,134.667 501.412,134.936 
  508.561,134.819 515.71,132.143 522.859,126.117 530.008,122.109 537.157,117.823 544.306,113.442 551.454,105.803 558.603,99.122 565.752,95.0144 572.901,95.2417 
  580.05,92.369 587.199,89.8635 594.348,91.5387 601.497,92.6263 608.645,92.4025 615.794,92.4959 622.943,90.9943 630.092,89.9062 637.241,91.2168 644.39,92.3867 
  651.539,93.1174 658.687,92.0456 665.836,89.6531 672.985,92.6913 680.134,92.8757 687.283,89.7812 694.432,90.4675 701.581,90.6361 708.73,91.5028 715.878,92.4444 
  723.027,91.9725 730.176,92.1645 737.325,91.3766 744.474,89.3337 751.623,90.0198 758.772,90.355 765.921,90.8378 773.069,92.0639 780.218,91.7275 787.367,91.1124 
  794.516,89.5798 801.665,90.8959 808.814,91.7883 815.963,91.1187 823.112,90.5793 830.26,89.5526 837.409,90.3516 844.558,91.6644 851.707,91.5035 858.856,93.2777 
  866.005,94.4675 873.154,93.8928 880.303,93.8696 887.451,95.2325 894.6,95.3135 901.749,94.0846 908.898,93.0543 916.047,90.402 923.196,90.2674 930.345,90.6594 
  937.494,90.3827 944.642,89.3153 951.791,89.9363 958.94,89.3818 966.089,90.5093 973.238,93.1476 980.387,93.0686 987.536,91.7199 994.685,90.5768 1001.83,90.2397 
  1008.98,89.9155 1016.13,90.4803 1023.28,90.095 1030.43,90.73 1037.58,90.1814 1044.73,91.244 1051.88,90.5142 1059.02,90.0235 1066.17,91.0805 1073.32,91.8003 
  1080.47,93.1522 1087.62,93.7182 1094.77,93.1331 1101.92,93.0257 1109.07,93.3827 1116.22,93.2703 1123.36,92.0163 1130.51,90.2717 1137.66,89.7084 1144.81,89.494 
  1151.96,89.5217 1159.11,90.0742 1166.26,92.954 1173.41,94.2528 1180.56,93.9024 1187.7,91.6911 1194.85,89.6565 1202,90.7062 1209.15,90.6267 1216.3,90.7459 
  1223.45,90.9483 1230.6,90.0753 1237.75,89.3809 1244.9,90.2402 1252.04,90.1421 1259.19,90.5908 1266.34,90.963 1273.49,90.9783 1280.64,90.2939 1287.79,88.9611 
  1294.94,89.562 1302.09,90.3224 1309.23,90.847 1316.38,93.0034 1323.53,93.5982 1330.68,93.1277 1337.83,92.5658 1344.98,90.5697 1352.13,90.238 1359.28,93.0047 
  1366.43,92.9789 1373.57,92.3248 1380.72,91.7353 1387.87,90.5787 1395.02,89.8296 1402.17,91.0101 1409.32,92.2411 1416.47,91.4404 1423.62,93.068 1430.77,92.9481 
  1437.91,92.5016 1445.06,92.0848 1452.21,91.6619 1459.36,90.975 1466.51,91.6085 1473.66,91.139 1480.81,90.0602 1487.96,90.2849 1495.11,89.6835 1502.25,90.0842 
  1509.4,90.226 1516.55,91.0888 1523.7,93.025 1530.85,91.9784 1538,92.0207 1545.15,92.4132 1552.3,92.4236 1559.45,91.4691 1566.59,90.2529 1573.74,90.2145 
  1580.89,90.4277 1588.04,91.5645 1595.19,92.0045 1602.34,91.0752 1609.49,90.6812 1616.64,90.9833 1623.79,90.9526 1630.93,92.2808 1638.08,91.8394 1645.23,91.5873 
  1652.38,90.5963 1659.53,89.3826 1666.68,89.0425 1673.83,88.9544 1680.98,89.5276 1688.13,90.1318 1695.27,89.8898 1702.42,90.3736 1709.57,91.3421 1716.72,91.6982 
  1723.87,89.6794 1731.02,89.7912 1738.17,90.2971 1745.32,91.0185 1752.47,90.5545 1759.61,90.5058 1766.76,92.3395 1773.91,92.8352 1781.06,92.5874 1788.21,92.552 
  1795.36,91.4174 1802.51,89.6137 1809.66,90.4669 1816.8,90.1705 1823.95,90.3875 1831.1,91.1951 1838.25,91.0247 1845.4,90.7739 1852.55,89.5591 1859.7,89.4494 
  1866.85,89.739 1874,90.0024 1881.14,90.8687 1888.29,92.4427 1895.44,92.1244 1902.59,90.3114 1909.74,89.0904 1916.89,91.3673 1924.04,91.6594 1931.19,90.9034 
  1938.34,90.0902 1945.48,89.1533 1952.63,90.2993 1959.78,90.558 1966.93,90.835 1974.08,91.3298 1981.23,91.443 1988.38,91.3103 1995.53,90.8607 2002.68,90.8178 
  2009.82,90.4185 2016.97,89.3846 2024.12,90.022 2031.27,90.2894 2038.42,91.5047 2045.57,91.094 2052.72,92.3367 2059.87,91.7418 2067.02,90.943 2074.16,89.6843 
  2081.31,89.3243 2088.46,89.5648 2095.61,89.8565 2102.76,89.8082 2109.91,89.5299 2117.06,90.7002 2124.21,93.032 2131.36,93.4065 2138.5,93.3029 2145.65,93.448 
  2152.8,93.343 2159.95,92.9699 2167.1,94.0979 2174.25,93.4925 2181.4,93.3034 2188.55,92.3242 2195.7,89.542 2202.84,91.1544 2209.99,91.141 2217.14,90.389 
  2224.29,89.7324 2231.44,91.3845 2238.59,92.2137 2245.74,92.6301 2252.89,91.3407 2260.04,89.4482 2267.18,90.3001 2274.33,90.6424 2281.48,89.7033 2288.63,89.7425 
  
  "/>
<path clip-path="url(#clip8800)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip8800)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip8800)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip8800)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../NPG/">Learning a control policy »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 January 2020 02:41">Monday 13 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
