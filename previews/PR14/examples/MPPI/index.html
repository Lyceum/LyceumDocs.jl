<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li><li><a class="tocitem" href="../NPG/">Learning a control policy</a></li><li><a class="tocitem" href="../visualize/">Visualizing Results</a></li><li><a class="tocitem" href="../humanoid/">Creating a MuJoCo Environment</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 10,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 1000 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip8300">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip8300)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip8301">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip8300)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip8302">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip8302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip8302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip8302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip8302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip8302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1479.3 2352.76,1479.3 
  "/>
<polyline clip-path="url(#clip8302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.7 2352.76,1131.7 
  "/>
<polyline clip-path="url(#clip8302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,784.103 2352.76,784.103 
  "/>
<polyline clip-path="url(#clip8302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.506 2352.76,436.506 
  "/>
<polyline clip-path="url(#clip8302)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.9088 2352.76,88.9088 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1479.3 114.181,1479.3 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.7 114.181,1131.7 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,784.103 114.181,784.103 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.506 114.181,436.506 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.9088 114.181,88.9088 
  "/>
<g clip-path="url(#clip8300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip8300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip8300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip8300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip8300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.8)" x="62.9921" y="1496.8">0.00</text>
</g>
<g clip-path="url(#clip8300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1149.2)" x="62.9921" y="1149.2">0.25</text>
</g>
<g clip-path="url(#clip8300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.603)" x="62.9921" y="801.603">0.50</text>
</g>
<g clip-path="url(#clip8300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 454.006)" x="62.9921" y="454.006">0.75</text>
</g>
<g clip-path="url(#clip8300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.409)" x="62.9921" y="106.409">1.00</text>
</g>
<polyline clip-path="url(#clip8302)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1479.3 158.266,1478.94 165.415,1477.9 172.564,1476.2 179.713,1473.63 186.862,1469.66 194.011,1463.85 201.16,1457.17 208.308,1449.09 215.457,1438.67 
  222.606,1425.9 229.755,1411.99 236.904,1395.47 244.053,1377.45 251.202,1358.33 258.351,1335.87 265.499,1312.75 272.648,1288.92 279.797,1262.22 286.946,1234.15 
  294.095,1204.84 301.244,1174.23 308.393,1141.23 315.542,1107.22 322.69,1071.32 329.839,1033.74 336.988,994.797 344.137,953.967 351.286,912.228 358.435,868.909 
  365.584,824.106 372.733,778.396 379.881,730.974 387.03,682.374 394.179,631.893 401.328,580.306 408.477,527.665 415.626,473.497 422.775,419.137 429.924,364.694 
  437.072,311.679 444.221,259.856 451.37,208.268 458.519,158.711 465.668,111.669 472.817,110.761 479.966,153.808 487.115,194.249 494.263,232.243 501.412,269.517 
  508.561,305.36 515.71,339.576 522.859,373.654 530.008,405.641 537.157,436.595 544.306,466.121 551.454,494.3 558.603,521.008 565.752,545.8 572.901,570.977 
  580.05,596.174 587.199,622.132 594.348,648.314 601.497,647.61 608.645,644.703 615.794,639.581 622.943,633.035 630.092,624.783 637.241,614.704 644.39,603.61 
  651.539,591.131 658.687,577.432 665.836,562.189 672.985,545.521 680.134,527.715 687.283,507.29 694.432,483.778 701.581,458.974 708.73,433.446 715.878,404.871 
  723.027,373.97 730.176,341.787 737.325,308.415 744.474,273.724 751.623,238.996 758.772,203.91 765.921,170.244 773.069,138.157 780.218,108.012 787.367,99.9486 
  794.516,127.108 801.665,153.216 808.814,178.21 815.963,201.11 823.112,222.325 830.26,241.842 837.409,258.951 844.558,274.025 851.707,287.432 858.856,299.094 
  866.005,309.462 873.154,318.465 880.303,326.445 887.451,333.645 894.6,338.711 901.749,341.018 908.898,341.636 916.047,340.959 923.196,337.851 930.345,331.843 
  937.494,323.416 944.642,312.898 951.791,300.943 958.94,286.554 966.089,270.973 973.238,253.636 980.387,235.34 987.536,215.634 994.685,194.643 1001.83,173.506 
  1008.98,154.358 1016.13,136.967 1023.28,120.684 1030.43,106.279 1037.58,94.0843 1044.73,97.1153 1051.88,105.229 1059.02,112.164 1066.17,115.853 1073.32,117.947 
  1080.47,117.81 1087.62,115.323 1094.77,111.817 1101.92,107.592 1109.07,103.33 1116.22,99.8976 1123.36,97.0183 1130.51,94.5724 1137.66,92.9819 1144.81,91.7943 
  1151.96,90.7664 1159.11,90.309 1166.26,90.0353 1173.41,89.779 1180.56,89.5809 1187.7,89.6343 1194.85,89.8718 1202,89.6261 1209.15,89.7983 1216.3,89.8637 
  1223.45,89.6418 1230.6,89.7437 1237.75,89.47 1244.9,89.0796 1252.04,89.2639 1259.19,89.1932 1266.34,89.3535 1273.49,89.8287 1280.64,90.3441 1287.79,90.6561 
  1294.94,90.6493 1302.09,90.694 1309.23,90.5863 1316.38,89.9289 1323.53,89.2768 1330.68,89.2591 1337.83,88.9544 1344.98,89.0258 1352.13,89.056 1359.28,89.216 
  1366.43,89.5423 1373.57,89.3922 1380.72,89.312 1387.87,89.0943 1395.02,89.3356 1402.17,89.6219 1409.32,89.4339 1416.47,89.3782 1423.62,89.6966 1430.77,90.4063 
  1437.91,90.4057 1445.06,90.3116 1452.21,90.4913 1459.36,90.1335 1466.51,89.8756 1473.66,89.378 1480.81,89.544 1487.96,89.3362 1495.11,89.3273 1502.25,89.0481 
  1509.4,89.3611 1516.55,89.3951 1523.7,89.2455 1530.85,89.482 1538,89.1612 1545.15,89.4849 1552.3,89.5679 1559.45,89.6791 1566.59,89.7918 1573.74,89.7028 
  1580.89,89.7324 1588.04,90.0859 1595.19,90.0331 1602.34,89.6546 1609.49,89.3274 1616.64,89.2435 1623.79,89.2482 1630.93,89.0549 1638.08,89.0342 1645.23,89.089 
  1652.38,89.1772 1659.53,89.0751 1666.68,89.2841 1673.83,89.7779 1680.98,89.9052 1688.13,89.7407 1695.27,89.7636 1702.42,89.5317 1709.57,89.0906 1716.72,89.3881 
  1723.87,89.461 1731.02,89.1957 1738.17,89.2452 1745.32,89.6633 1752.47,89.9425 1759.61,89.7701 1766.76,89.4397 1773.91,89.4752 1781.06,89.3997 1788.21,89.5758 
  1795.36,89.8088 1802.51,89.5407 1809.66,89.0226 1816.8,89.4573 1823.95,89.7738 1831.1,89.6157 1838.25,89.3729 1845.4,89.4412 1852.55,89.4559 1859.7,89.3923 
  1866.85,89.484 1874,89.5271 1881.14,89.2946 1888.29,89.8609 1895.44,90.0552 1902.59,89.8475 1909.74,89.8253 1916.89,89.6791 1924.04,89.371 1931.19,89.1374 
  1938.34,89.477 1945.48,89.2728 1952.63,89.1073 1959.78,89.1401 1966.93,89.5174 1974.08,89.6677 1981.23,89.7378 1988.38,89.7086 1995.53,89.6507 2002.68,89.292 
  2009.82,89.1681 2016.97,89.3372 2024.12,89.835 2031.27,90.2415 2038.42,90.5223 2045.57,90.5885 2052.72,90.3877 2059.87,90.172 2067.02,89.9327 2074.16,89.5762 
  2081.31,89.4475 2088.46,89.4475 2095.61,89.3048 2102.76,89.2392 2109.91,89.4415 2117.06,89.8992 2124.21,89.9117 2131.36,89.5686 2138.5,89.564 2145.65,89.4272 
  2152.8,89.401 2159.95,89.5289 2167.1,89.2665 2174.25,89.3603 2181.4,89.5615 2188.55,89.4933 2195.7,89.0842 2202.84,89.1031 2209.99,89.1451 2217.14,89.1359 
  2224.29,89.2467 2231.44,89.4528 2238.59,89.2657 2245.74,89.4601 2252.89,89.5809 2260.04,89.5008 2267.18,89.5216 2274.33,89.6235 2281.48,89.1576 2288.63,89.144 
  
  "/>
<path clip-path="url(#clip8300)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip8300)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip8300)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip8300)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../NPG/">Learning a control policy »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 January 2020 03:01">Monday 13 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
