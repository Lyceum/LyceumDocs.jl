<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li><li><a class="tocitem" href="../NPG/">Learning a control policy</a></li><li><a class="tocitem" href="../visualize/">Visualizing Results</a></li><li><a class="tocitem" href="../humanoid/">Creating a MuJoCo Environment</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 10,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 1000 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip7600">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip7600)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip7601">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip7600)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip7602">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip7602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip7602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip7602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip7602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip7602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1479.3 2352.76,1479.3 
  "/>
<polyline clip-path="url(#clip7602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.71 2352.76,1131.71 
  "/>
<polyline clip-path="url(#clip7602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,784.117 2352.76,784.117 
  "/>
<polyline clip-path="url(#clip7602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.527 2352.76,436.527 
  "/>
<polyline clip-path="url(#clip7602)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.9364 2352.76,88.9364 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1479.3 114.181,1479.3 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.71 114.181,1131.71 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,784.117 114.181,784.117 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.527 114.181,436.527 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.9364 114.181,88.9364 
  "/>
<g clip-path="url(#clip7600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip7600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip7600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip7600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip7600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.8)" x="62.9921" y="1496.8">0.00</text>
</g>
<g clip-path="url(#clip7600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1149.21)" x="62.9921" y="1149.21">0.25</text>
</g>
<g clip-path="url(#clip7600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.617)" x="62.9921" y="801.617">0.50</text>
</g>
<g clip-path="url(#clip7600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 454.027)" x="62.9921" y="454.027">0.75</text>
</g>
<g clip-path="url(#clip7600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.436)" x="62.9921" y="106.436">1.00</text>
</g>
<polyline clip-path="url(#clip7602)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1479.3 158.266,1478.89 165.415,1477.6 172.564,1475.31 179.713,1471.62 186.862,1466.55 194.011,1459.32 201.16,1450.01 208.308,1439.44 215.457,1427.97 
  222.606,1414.35 229.755,1399.55 236.904,1382.39 244.053,1362.98 251.202,1341.64 258.351,1317.71 265.499,1292.51 272.648,1266.18 279.797,1238.57 286.946,1208.26 
  294.095,1175.68 301.244,1143.41 308.393,1109.71 315.542,1074.38 322.69,1037.07 329.839,998.201 336.988,957.487 344.137,914.278 351.286,869.081 358.435,823.206 
  365.584,776.323 372.733,728.379 379.881,678.847 387.03,626.539 394.179,572.569 401.328,517.192 408.477,461.315 415.626,405.912 422.775,349.995 429.924,294.062 
  437.072,239.632 444.221,187.766 451.37,138.073 458.519,94.4732 465.668,134.682 472.817,179.494 479.966,223.224 487.115,264.68 494.263,303.72 501.412,340.666 
  508.561,376.439 515.71,410.45 522.859,442.585 530.008,473.914 537.157,503.872 544.306,533.11 551.454,562.135 558.603,591.25 565.752,619.873 572.901,648.402 
  580.05,647.926 587.199,644.682 594.348,640.017 601.497,633.802 608.645,625.256 615.794,614.804 622.943,602.653 630.092,588.886 637.241,573.462 644.39,556.273 
  651.539,536.5 658.687,514.186 665.836,491.759 672.985,468.202 680.134,443.112 687.283,414.091 694.432,382.267 701.581,349.254 708.73,315.043 715.878,280.978 
  723.027,247.275 730.176,213.874 737.325,181.928 744.474,151.652 751.623,122.728 758.772,96.6495 765.921,108.333 773.069,131.612 780.218,152.89 787.367,172.028 
  794.516,189.777 801.665,206.29 808.814,221.372 815.963,235.605 823.112,247.459 830.26,257.214 837.409,264.546 844.558,269.749 851.707,273.25 858.856,273.649 
  866.005,272.985 873.154,271.17 880.303,267.318 887.451,261.956 894.6,254.936 901.749,247.728 908.898,240.207 916.047,230.965 923.196,219.477 930.345,206.808 
  937.494,193.182 944.642,179.273 951.791,164.789 958.94,151.561 966.089,138.669 973.238,126.999 980.387,117.099 987.536,108.384 994.685,101.912 1001.83,97.438 
  1008.98,94.2485 1016.13,92.4782 1023.28,91.3354 1030.43,90.2869 1037.58,89.9093 1044.73,89.9945 1051.88,90.0512 1059.02,89.7465 1066.17,89.2788 1073.32,89.3098 
  1080.47,89.3965 1087.62,89.398 1094.77,89.5285 1101.92,89.4699 1109.07,89.4947 1116.22,89.4436 1123.36,89.4236 1130.51,89.4352 1137.66,89.785 1144.81,89.7661 
  1151.96,89.3905 1159.11,89.1803 1166.26,89.3084 1173.41,89.1669 1180.56,89.1862 1187.7,89.2727 1194.85,89.7606 1202,89.8262 1209.15,89.7092 1216.3,89.5741 
  1223.45,89.8714 1230.6,89.8581 1237.75,89.3437 1244.9,89.2858 1252.04,89.4472 1259.19,89.6018 1266.34,89.5765 1273.49,89.5625 1280.64,89.5148 1287.79,89.9181 
  1294.94,89.9565 1302.09,90.4044 1309.23,90.0494 1316.38,89.6291 1323.53,89.6193 1330.68,89.2607 1337.83,90.0352 1344.98,89.6197 1352.13,89.3178 1359.28,89.1796 
  1366.43,89.3941 1373.57,89.9613 1380.72,89.7652 1387.87,89.3754 1395.02,88.9781 1402.17,89.2377 1409.32,89.0425 1416.47,89.0967 1423.62,89.4431 1430.77,89.4701 
  1437.91,89.3626 1445.06,89.4138 1452.21,89.2332 1459.36,89.1387 1466.51,89.0715 1473.66,89.4878 1480.81,89.5341 1487.96,89.9091 1495.11,89.6178 1502.25,89.8411 
  1509.4,89.9552 1516.55,90.6342 1523.7,90.8683 1530.85,90.4852 1538,90.1449 1545.15,89.8031 1552.3,89.8363 1559.45,89.7627 1566.59,89.456 1573.74,89.3567 
  1580.89,89.0004 1588.04,89.5459 1595.19,89.6597 1602.34,89.5159 1609.49,89.3688 1616.64,89.4187 1623.79,89.1131 1630.93,88.9544 1638.08,89.0715 1645.23,89.4582 
  1652.38,89.8291 1659.53,89.8007 1666.68,89.6286 1673.83,89.5483 1680.98,89.8131 1688.13,89.4979 1695.27,89.6244 1702.42,89.5837 1709.57,89.929 1716.72,89.9012 
  1723.87,89.8444 1731.02,89.8934 1738.17,89.6993 1745.32,89.4101 1752.47,89.1675 1759.61,89.5652 1766.76,89.4997 1773.91,89.0983 1781.06,89.609 1788.21,89.8505 
  1795.36,89.7803 1802.51,89.3197 1809.66,89.2651 1816.8,89.6288 1823.95,89.8763 1831.1,89.9271 1838.25,89.9665 1845.4,89.733 1852.55,89.7282 1859.7,89.8193 
  1866.85,90.1204 1874,90.1597 1881.14,90.0812 1888.29,90.0957 1895.44,89.5928 1902.59,89.1198 1909.74,89.4285 1916.89,89.7395 1924.04,89.903 1931.19,89.6055 
  1938.34,89.0796 1945.48,89.184 1952.63,89.353 1959.78,89.5524 1966.93,89.7497 1974.08,89.6234 1981.23,89.8088 1988.38,90.0686 1995.53,90.0145 2002.68,89.8143 
  2009.82,89.6484 2016.97,89.4796 2024.12,89.6607 2031.27,89.247 2038.42,89.0742 2045.57,89.4189 2052.72,89.4672 2059.87,89.5761 2067.02,90.0226 2074.16,90.0801 
  2081.31,89.5807 2088.46,88.9911 2095.61,88.9828 2102.76,89.1647 2109.91,89.4561 2117.06,89.4434 2124.21,89.451 2131.36,89.113 2138.5,89.2538 2145.65,89.4844 
  2152.8,89.4111 2159.95,89.3777 2167.1,89.7301 2174.25,90.236 2181.4,90.2433 2188.55,90.3102 2195.7,90.2859 2202.84,89.8244 2209.99,89.5271 2217.14,89.3892 
  2224.29,89.2178 2231.44,89.0912 2238.59,89.0991 2245.74,89.0616 2252.89,89.4554 2260.04,89.5279 2267.18,89.6357 2274.33,89.5899 2281.48,89.5794 2288.63,89.569 
  
  "/>
<path clip-path="url(#clip7600)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip7600)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip7600)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip7600)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../NPG/">Learning a control policy »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 January 2020 07:40">Monday 13 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
