<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Visualizing Results · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/visualize/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../MPPI/">Running a simple controller</a></li><li><a class="tocitem" href="../NPG/">Learning a control policy</a></li><li class="is-active"><a class="tocitem" href>Visualizing Results</a></li><li><a class="tocitem" href="../humanoid/">Creating a MuJoCo Environment</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Visualizing Results</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Visualizing Results</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/visualize.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Visualizing-Results-1"><a class="docs-heading-anchor" href="#Visualizing-Results-1">Visualizing Results</a><a class="docs-heading-anchor-permalink" href="#Visualizing-Results-1" title="Permalink"></a></h1><pre><code class="language-">using LyceumBase, LyceumAI, MuJoCo, Shapes, FastClosures
using LyceumMuJoCo    # We need to bring the Pointmass, Hopper Envs into the workspace
using LyceumMuJoCoViz # This provides our visualization needs.
using JLSO
using FastClosures</code></pre><p>The following functions present two modes of visualizing results of NPG or MPPI packaged in LyceumAI. They both work by passing into the &#39;visualize&#39; function a control function and/or trajectory data to be rendered. These inputs select from available visualization modes TODO list the visualiza3tion modes here. that operate on either data passed in (the trajectory option) or will simulate the forward dynamics of the environment, and call the pass in control function appropriately. This allows for interactive policy evaluation or full model predictive control with MPPI.</p><pre><code class="language-julia">function viz_mppi(mppi::MPPI, env::AbstractMuJoCoEnvironment)
    a = allocate(actionspace(env))
    o = allocate(obsspace(env))
    s = allocate(statespace(env))

    ctrlfn = @closure env -&gt; (getstate!(s, env); getaction!(a, s, o, mppi); setaction!(env, a))

    # The above line is functionally the same as:
    # ctrlfn(env) = begin
    #     getstate!(s, env)
    #     getaction!(a, s, o, mppi)
    #     setaction!(env, a)
    # end
    visualize(env, controller=ctrlfn)
end

function viz_policy(path::AbstractString, etype::Union{Nothing, Type{&lt;:AbstractMuJoCoEnvironment}}=nothing)
    x = JLSO.load(path)
    etype = isnothing(etype) ? x[&quot;etype&quot;] : etype
    env = etype() # Load the environment based on what was in the JLSO file.

    # Check if the JLSO has a policy saved, if so, load it and prepare to render
    # the stochastic rollouts of the policy, and form a control function that is the policy&#39;s
    # mean outputs w.r.t. observations.
    # Otherwise, just render states, such as the output of MPPI.
    pol = haskey(x, &quot;policy&quot;) ? x[&quot;policy&quot;] : nothing

    if pol == nothing
        visualize(env; trajectories=[x[&quot;states&quot;]])
    else
        a = allocate(actionspace(env))
        o = allocate(obsspace(env))
        ctrlfn = @closure (env) -&gt; (getobs!(o, env); a .= pol(o); setaction!(env, a))

        states = x[&quot;stocstates&quot;].states
        visualize(env, controller=ctrlfn, trajectories=states)
    end
end</code></pre><pre><code class="language-none">viz_policy (generic function with 2 methods)</code></pre><p>Assuming we have the saved jlso files from the previous examples, we can call the above functions as such:</p><p>TODO the following lines are bullshit; don&#39;t run on build, add to md scripts and notebook</p><pre><code class="language-">viz_policy(&quot;/tmp/hopper_example.jlso&quot;, LyceumMuJoCo.HopperV2)
viz_policy(&quot;/tmp/opt_humanoid.jlso&quot;, Humanoid)
viz_mppi(mppi, LyceumMuJoCo.PointMass())</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../NPG/">« Learning a control policy</a><a class="docs-footer-nextpage" href="../humanoid/">Creating a MuJoCo Environment »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 January 2020 03:01">Monday 13 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
