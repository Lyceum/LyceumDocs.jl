<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a simple controller · Lyceum</title><link rel="canonical" href="https://docs.lyceum.ml/dev/examples/MPPI/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Lyceum</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Running a simple controller</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Running a simple controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a simple controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/docs/src/examples/MPPI.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info"><header class="admonition-header">Running examples locally</header><div class="admonition-body"><p>This example and more are also available as Julia scripts and Jupyter notebooks.</p><p>See <a href="https://github.com/Lyceum/LyceumDocs.jl/blob/master/example_howto.md">the how-to page</a> for more information.</p></div></div><h1 id="Running-a-simple-controller-1"><a class="docs-heading-anchor" href="#Running-a-simple-controller-1">Running a simple controller</a><a class="docs-heading-anchor-permalink" href="#Running-a-simple-controller-1" title="Permalink"></a></h1><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>In this example we walk through the process of setting up an experiment that runs <a href="https://ieeexplore.ieee.org/iel7/7478842/7487087/07487277.pdf">Model-Predictive Path Integral Control</a>, or &quot;MPPI&quot;, a Model-Predictive Control method, on a simple PointMass environment.</p><p>First, let&#39;s go head and grab all the dependencies</p><pre><code class="language-julia">using LinearAlgebra, Random, Statistics # From Stdlib
using LyceumAI # For the MPPI controller
using LyceumMuJoCo # For the PointMass environment
using LyceumBase.Tools # For the ControllerIterator discussed below
using Plots</code></pre><p><strong>TODO LINK REF</strong> Next, we&#39;ll define an <code>Experiment</code> which we&#39;ll use to log the trajectory executed by our controller and save the results to &quot;/tmp/pointmass.jlso&quot;.</p><pre><code class="language-julia">exper = Experiment(&quot;/tmp/pointmass.jlso&quot;, overwrite = true);</code></pre><p>Then we configure and instantiate of our <code>PointMass</code> environment and <code>MPPI</code> controller. See the documention for <code>MPPI</code> to learn more about its parameters. <strong>TODO LINK REF</strong></p><pre><code class="language-julia">env = LyceumMuJoCo.PointMass();
mppi = MPPI(
    env_tconstructor = i -&gt; tconstruct(LyceumMuJoCo.PointMass, i),
    covar0 = Diagonal(0.1^2 * I, size(actionspace(env), 1)),
    lambda = 0.01,
    K = 32,
    H = 20,
    gamma = 0.99,
);</code></pre><p>Finally, let&#39;s rollout our controller for 1000 timesteps. As discused in the algorithms section <strong>TODO LINK REF</strong>, <code>AbstractController</code>&#39;s are by themselves not iterable, so we wrap them in a <code>ControllerIterator</code> which will apply the controls generated by <code>MPPI</code> to the environment at each timestep. We&#39;ll also plot the progress so far to the terminal every 100 timesteps. For clarity, we do not reproduce these plots here, but you&#39;ll see them when you run this example locally!</p><pre><code class="language-julia">iter = ControllerIterator(mppi, env; T = 300, plotiter = 50);
for (t, traj) in iter
end</code></pre><p>Let&#39;s go ahead and plot the final reward trajectory and see how we did:</p><pre><code class="language-julia">plot(iter.trajectory.rewards)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip2700">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip2700)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip2701">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip2700)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip2702">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip2702)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  143.969,1521.01 143.969,47.2441 
  "/>
<polyline clip-path="url(#clip2702)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  858.856,1521.01 858.856,47.2441 
  "/>
<polyline clip-path="url(#clip2702)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1573.74,1521.01 1573.74,47.2441 
  "/>
<polyline clip-path="url(#clip2702)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip2702)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1479.3 2352.76,1479.3 
  "/>
<polyline clip-path="url(#clip2702)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1131.69 2352.76,1131.69 
  "/>
<polyline clip-path="url(#clip2702)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,784.086 2352.76,784.086 
  "/>
<polyline clip-path="url(#clip2702)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,436.48 2352.76,436.48 
  "/>
<polyline clip-path="url(#clip2702)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.8741 2352.76,88.8741 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  143.969,1521.01 143.969,1503.32 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  858.856,1521.01 858.856,1503.32 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1573.74,1521.01 1573.74,1503.32 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1503.32 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1479.3 114.181,1479.3 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1131.69 114.181,1131.69 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,784.086 114.181,784.086 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,436.48 114.181,436.48 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.8741 114.181,88.8741 
  "/>
<g clip-path="url(#clip2700)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 143.969, 1575.01)" x="143.969" y="1575.01">0</text>
</g>
<g clip-path="url(#clip2700)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 858.856, 1575.01)" x="858.856" y="1575.01">100</text>
</g>
<g clip-path="url(#clip2700)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 1573.74, 1575.01)" x="1573.74" y="1575.01">200</text>
</g>
<g clip-path="url(#clip2700)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:middle;" transform="rotate(0, 2288.63, 1575.01)" x="2288.63" y="1575.01">300</text>
</g>
<g clip-path="url(#clip2700)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1496.8)" x="62.9921" y="1496.8">0.00</text>
</g>
<g clip-path="url(#clip2700)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 1149.19)" x="62.9921" y="1149.19">0.25</text>
</g>
<g clip-path="url(#clip2700)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 801.586)" x="62.9921" y="801.586">0.50</text>
</g>
<g clip-path="url(#clip2700)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 453.98)" x="62.9921" y="453.98">0.75</text>
</g>
<g clip-path="url(#clip2700)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:end;" transform="rotate(0, 62.9921, 106.374)" x="62.9921" y="106.374">1.00</text>
</g>
<polyline clip-path="url(#clip2702)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1479.3 158.266,1478.79 165.415,1477.39 172.564,1474.33 179.713,1470.76 186.862,1463.29 194.011,1453.99 201.16,1442.49 208.308,1429.78 215.457,1414.35 
  222.606,1397.56 229.755,1379.98 236.904,1363.23 244.053,1342.38 251.202,1318.03 258.351,1289.77 265.499,1257.55 272.648,1224.23 279.797,1190.59 286.946,1152.91 
  294.095,1113.01 301.244,1071.72 308.393,1030.13 315.542,984.533 322.69,935.06 329.839,883.211 336.988,831.503 344.137,776.766 351.286,720.837 358.435,663.856 
  365.584,607.674 372.733,551.975 379.881,495.245 387.03,442.024 394.179,390.711 401.328,342.537 408.477,297.799 415.626,257.306 422.775,221.123 429.924,188.937 
  437.072,161.143 444.221,135.844 451.37,113.423 458.519,95.7767 465.668,99.8432 472.817,112.409 479.966,121.119 487.115,129.11 494.263,135.87 501.412,139.822 
  508.561,142.654 515.71,142.106 522.859,139.266 530.008,133.366 537.157,128.088 544.306,122.845 551.454,116.3 558.603,109.947 565.752,104.952 572.901,100.279 
  580.05,96.1955 587.199,93.8969 594.348,93.087 601.497,91.5069 608.645,91.1396 615.794,93.5729 622.943,93.0615 630.092,91.9142 637.241,90.0813 644.39,90.4561 
  651.539,89.9163 658.687,89.5883 665.836,91.265 672.985,91.4268 680.134,90.974 687.283,92.6052 694.432,92.7498 701.581,92.5327 708.73,91.6437 715.878,89.9313 
  723.027,89.7266 730.176,89.6633 737.325,90.192 744.474,90.5291 751.623,91.4192 758.772,91.287 765.921,91.6926 773.069,92.1429 780.218,92.4605 787.367,93.7554 
  794.516,93.8244 801.665,93.2539 808.814,90.6087 815.963,89.7649 823.112,89.497 830.26,91.4368 837.409,91.384 844.558,91.5797 851.707,90.964 858.856,89.527 
  866.005,89.9959 873.154,90.2763 880.303,89.0589 887.451,90.8223 894.6,92.1786 901.749,93.3247 908.898,92.486 916.047,91.402 923.196,91.4194 930.345,91.9575 
  937.494,90.8183 944.642,90.897 951.791,90.7673 958.94,91.0729 966.089,90.6589 973.238,89.4809 980.387,89.0783 987.536,90.11 994.685,91.2856 1001.83,92.1583 
  1008.98,93.2274 1016.13,92.7121 1023.28,91.7243 1030.43,92.0922 1037.58,91.8094 1044.73,90.8516 1051.88,90.5019 1059.02,90.2606 1066.17,90.9076 1073.32,91.2408 
  1080.47,91.7718 1087.62,90.826 1094.77,88.9544 1101.92,89.7073 1109.07,89.7239 1116.22,90.7848 1123.36,90.5233 1130.51,90.387 1137.66,90.6353 1144.81,91.6387 
  1151.96,90.8235 1159.11,91.9319 1166.26,91.8871 1173.41,92.1303 1180.56,91.6205 1187.7,89.6212 1194.85,91.8272 1202,92.9787 1209.15,92.6955 1216.3,90.5667 
  1223.45,90.0267 1230.6,90.6738 1237.75,92.8007 1244.9,95.2753 1252.04,94.3397 1259.19,92.0491 1266.34,90.3945 1273.49,90.5951 1280.64,90.3538 1287.79,89.5548 
  1294.94,90.4195 1302.09,90.2561 1309.23,89.9686 1316.38,90.698 1323.53,91.3647 1330.68,91.9728 1337.83,92.406 1344.98,92.32 1352.13,92.2659 1359.28,93.1052 
  1366.43,91.4797 1373.57,90.2177 1380.72,90.1796 1387.87,90.729 1395.02,89.7541 1402.17,90.2597 1409.32,91.1353 1416.47,91.7096 1423.62,90.3459 1430.77,89.9764 
  1437.91,91.3481 1445.06,91.4881 1452.21,91.4659 1459.36,91.3245 1466.51,91.2649 1473.66,89.9806 1480.81,89.452 1487.96,89.2987 1495.11,89.9009 1502.25,92.6902 
  1509.4,93.2439 1516.55,90.9114 1523.7,89.8355 1530.85,90.6991 1538,90.4686 1545.15,90.3208 1552.3,90.4972 1559.45,91.175 1566.59,91.4166 1573.74,90.7893 
  1580.89,92.3547 1588.04,92.203 1595.19,92.0462 1602.34,91.8284 1609.49,90.2475 1616.64,89.7392 1623.79,90.6082 1630.93,90.7211 1638.08,90.2057 1645.23,90.7049 
  1652.38,90.9082 1659.53,91.5845 1666.68,92.5566 1673.83,92.8485 1680.98,90.2875 1688.13,89.7485 1695.27,89.9853 1702.42,90.1784 1709.57,92.4102 1716.72,93.6157 
  1723.87,91.762 1731.02,90.043 1738.17,90.1861 1745.32,91.2449 1752.47,91.5894 1759.61,90.2669 1766.76,89.499 1773.91,91.1148 1781.06,89.5669 1788.21,90.1727 
  1795.36,91.0576 1802.51,92.5101 1809.66,93.4684 1816.8,93.2711 1823.95,93.0163 1831.1,91.7405 1838.25,89.4732 1845.4,90.0662 1852.55,90.2914 1859.7,91.1475 
  1866.85,91.3389 1874,92.2383 1881.14,90.8522 1888.29,91.3024 1895.44,93.093 1902.59,93.4452 1909.74,91.7043 1916.89,89.9213 1924.04,89.4902 1931.19,89.7173 
  1938.34,89.6449 1945.48,90.2453 1952.63,93.6933 1959.78,94.7085 1966.93,95.4795 1974.08,94.7651 1981.23,92.5376 1988.38,91.2825 1995.53,90.5335 2002.68,90.466 
  2009.82,90.0894 2016.97,89.8758 2024.12,89.5644 2031.27,89.6058 2038.42,90.3493 2045.57,89.8131 2052.72,91.1617 2059.87,92.8429 2067.02,93.1613 2074.16,93.7267 
  2081.31,94.3324 2088.46,93.4212 2095.61,92.9725 2102.76,91.9719 2109.91,92.0821 2117.06,92.1818 2124.21,90.7505 2131.36,89.809 2138.5,90.83 2145.65,89.3085 
  2152.8,90.159 2159.95,92.5132 2167.1,92.9034 2174.25,93.9464 2181.4,95.3814 2188.55,95.3256 2195.7,96.052 2202.84,95.2665 2209.99,94.7239 2217.14,93.5686 
  2224.29,91.8613 2231.44,90.694 2238.59,89.884 2245.74,89.907 2252.89,89.8319 2260.04,90.392 2267.18,91.7752 2274.33,92.6645 2281.48,94.0608 2288.63,94.9501 
  
  "/>
<path clip-path="url(#clip2700)" d="
M1989.93 251.724 L2280.76 251.724 L2280.76 130.764 L1989.93 130.764  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip2700)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1989.93,251.724 2280.76,251.724 2280.76,130.764 1989.93,130.764 1989.93,251.724 
  "/>
<polyline clip-path="url(#clip2700)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2013.93,191.244 2157.93,191.244 
  "/>
<g clip-path="url(#clip2700)">
<text style="fill:#000000; fill-opacity:1; font-family:Arial,Helvetica Neue,Helvetica,sans-serif; font-size:48px; text-anchor:start;" transform="rotate(0, 2181.93, 208.744)" x="2181.93" y="208.744">y1</text>
</g>
</svg>
<p>and save the results:</p><pre><code class="language-julia">for (k, v) in pairs(iter.trajectory)
    exper[k] = v
end
finish!(exper);</code></pre><pre><code class="language-none">[ Info: Experiment saved to /tmp/pointmass.jlso</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 January 2020 06:34">Monday 13 January 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
